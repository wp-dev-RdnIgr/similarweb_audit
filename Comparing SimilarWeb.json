{
  "name": "Comparing SimilarWeb",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 7
            }
          ]
        }
      },
      "id": "c30f57a7-e012-4567-82b2-9a333d60c4c5",
      "name": "Cron: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        16,
        528
      ],
      "notes": "–ö–∞–∂–¥—ã–π —á–∞—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—á–µ—Ä–µ–¥—å –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥–æ 9 –∑–∞–¥–∞—á"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "triggerAtHour": [
                8,
                20
              ]
            }
          ]
        }
      },
      "id": "2ac92421-090d-483c-8036-7e6359add027",
      "name": "Cron: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã (2x –≤ –¥–µ–Ω—å)",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        16,
        16
      ],
      "notes": "2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å (08:00 –∏ 20:00) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª–Ω–æ—Ç—É –¥–∞–Ω–Ω—ã—Ö –∑–∞ 10 –º–µ—Å—è—Ü–µ–≤"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 432048814,
          "mode": "list",
          "cachedResultName": "–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=432048814"
        },
        "options": {}
      },
      "id": "6e969da6-83ef-4e81-86f2-c369a41d9a70",
      "name": "–ß–∏—Ç–∞–µ–º –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        240,
        -48
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "numberInputs": 2
      },
      "id": "39f9149b-75ff-419b-b4f2-fafd98b79844",
      "name": "–û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        464,
        96
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 807869987,
          "mode": "list",
          "cachedResultName": "–û—á–µ—Ä–µ–¥—å",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=807869987"
        },
        "options": {}
      },
      "id": "queue-check-node-0001-0001-000000000001",
      "name": "–ß–∏—Ç–∞–µ–º –æ—á–µ—Ä–µ–¥—å (–ø—Ä–æ–≤–µ—Ä–∫–∞)",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        240,
        240
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–µ—Å—è—Ü–µ–≤\n// –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: –†–∞–∑–±–∏–≤–∞–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –Ω–∞ –≥—Ä—É–ø–ø—ã –ø–æ 5 —Å–∞–π—Ç–æ–≤ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ SimilarWeb)\n// v3: –ü—Ä–æ–≤–µ—Ä—è–µ–º –í–°–ï –∑–∞–ø–∏—Å–∏ –≤ –æ—á–µ—Ä–µ–¥–∏ (–ª—é–±–æ–π —Å—Ç–∞—Ç—É—Å) –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤\nconst competitors = $('–ß–∏—Ç–∞–µ–º –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤').all();\n\n// –ß–∏—Ç–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –æ—á–µ—Ä–µ–¥—å —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏\nlet existingQueue = [];\ntry {\n  existingQueue = $('–ß–∏—Ç–∞–µ–º –æ—á–µ—Ä–µ–¥—å (–ø—Ä–æ–≤–µ—Ä–∫–∞)').all();\n} catch (e) {\n  // –û—á–µ—Ä–µ–¥—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π\n}\n\n// –ú–∞–∫—Å–∏–º—É–º —Å–∞–π—Ç–æ–≤ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ SimilarWeb (–∫–ª–∏–µ–Ω—Ç + 4 –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞)\nconst MAX_SITES_PER_REQUEST = 5;\n\n// –§—É–Ω–∫—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ–º–µ–Ω–∞ (—É–±–∏—Ä–∞–µ–º https://, www., trailing slash)\nfunction normalizeDomain(url) {\n  if (!url) return '';\n  return url\n    .replace(/^https?:\\/\\//i, '')\n    .replace(/^www\\./i, '')\n    .replace(/\\/+$/, '')\n    .toLowerCase()\n    .trim();\n}\n\n// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 –º–µ—Å—è—Ü–µ–≤ (—Å —É—á—ë—Ç–æ–º –∑–∞–¥–µ—Ä–∂–∫–∏ SimilarWeb –≤ 2 –º–µ—Å—è—Ü–∞)\n// SimilarWeb –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –º–µ—Å—è—Ü–∞\nfunction getLast10Months() {\n  const months = [];\n  const now = new Date();\n  \n  // –ù–∞—á–∏–Ω–∞–µ–º —Å 3-–≥–æ –º–µ—Å—è—Ü–∞ –Ω–∞–∑–∞–¥ (–ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–∫—É—â–∏–π –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π)\n  for (let i = 3; i <= 12; i++) {\n    const d = new Date(now.getFullYear(), now.getMonth() - i, 1);\n    const year = d.getFullYear();\n    const month = String(d.getMonth() + 1).padStart(2, '0');\n    months.push(`${year}.${month}`);\n  }\n  \n  return months;\n}\n\nconst last10Months = getLast10Months();\n\n// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º (—Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π –¥–æ–º–µ–Ω–æ–≤)\nconst clientCompetitors = new Map();\n\ncompetitors.forEach(row => {\n  const client = normalizeDomain(row.json.client_site);\n  const competitor = normalizeDomain(row.json.competitors_site);\n  \n  if (client && competitor) {\n    if (!clientCompetitors.has(client)) {\n      clientCompetitors.set(client, []);\n    }\n    if (!clientCompetitors.get(client).includes(competitor)) {\n      clientCompetitors.get(client).push(competitor);\n    }\n  }\n});\n\n// v3: –°–æ–±–∏—Ä–∞–µ–º –í–°–ï —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥–∏ (–ª—é–±–æ–π —Å—Ç–∞—Ç—É—Å)\n// –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –¥–ª—è —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á\nconst existingQueueKeys = new Set();\nexistingQueue.forEach(row => {\n  // –£—á–∏—Ç—ã–≤–∞–µ–º –í–°–ï –∑–∞–ø–∏—Å–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞\n  const key = `${row.json.client_site}_${row.json.period}_${row.json.sites_list}`;\n  existingQueueKeys.add(key);\n});\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ –Ω–∞ —á–∞–Ω–∫–∏\nfunction chunkArray(array, chunkSize) {\n  const chunks = [];\n  for (let i = 0; i < array.length; i += chunkSize) {\n    chunks.push(array.slice(i, i + chunkSize));\n  }\n  return chunks;\n}\n\n// –°–æ–∑–¥–∞—ë–º –∑–∞–¥–∞—á–∏ —Å —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º –Ω–∞ –≥—Ä—É–ø–ø—ã\nconst queueTasks = [];\n\nclientCompetitors.forEach((competitorsList, clientSite) => {\n  const competitorChunks = chunkArray(competitorsList, MAX_SITES_PER_REQUEST - 1);\n  \n  competitorChunks.forEach((chunk, chunkIndex) => {\n    last10Months.forEach((period, periodIndex) => {\n      const sitesInRequest = [clientSite, ...chunk];\n      const sitesList = sitesInRequest.join(',');\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–∞—è –∑–∞–¥–∞—á–∞ –≤ –æ—á–µ—Ä–µ–¥–∏ (–ª—é–±–æ–π —Å—Ç–∞—Ç—É—Å)\n      const queueKey = `${clientSite}_${period}_${sitesList}`;\n      if (existingQueueKeys.has(queueKey)) {\n        return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º - –∑–∞–¥–∞—á–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\n      }\n      \n      // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É\n      const taskId = `${clientSite}_${period}_chunk${chunkIndex}_${Date.now()}`;\n      \n      queueTasks.push({\n        queue_id: taskId,\n        client_site: clientSite,\n        sites_list: sitesList,\n        chunk_index: chunkIndex,\n        total_chunks: competitorChunks.length,\n        period: period,\n        status: 'pending',\n        priority: periodIndex,\n        created_at: new Date().toISOString().replace('T', ' ').substring(0, 19),\n        task_id: '',\n        error_message: ''\n      });\n    });\n  });\n});\n\nqueueTasks.sort((a, b) => b.priority - a.priority);\n\nconst summary = {\n  totalClients: clientCompetitors.size,\n  totalTasks: queueTasks.length,\n  skippedExisting: existingQueueKeys.size,\n  periods: last10Months,\n  maxSitesPerRequest: MAX_SITES_PER_REQUEST\n};\n\nconsole.log('Queue tasks summary:', summary);\n\nif (queueTasks.length === 0) {\n  return [{ json: { noNewTasks: true, summary } }];\n}\n\nreturn queueTasks.map(task => ({ json: task }));"
      },
      "id": "19b85d8a-b590-4d84-aaa8-cea697886401",
      "name": "–ê–Ω–∞–ª–∏–∑ –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        96
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "filter-new-tasks",
              "leftValue": "={{ $json.noNewTasks }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "fb407d3a-3b89-4c14-b095-7f30ae715581",
      "name": "–ï—Å—Ç—å –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏?",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        896,
        96
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 807869987,
          "mode": "list",
          "cachedResultName": "–û—á–µ—Ä–µ–¥—å",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=807869987"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "queue_id",
              "displayName": "queue_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_site",
              "displayName": "client_site",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "sites_list",
              "displayName": "sites_list",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "period",
              "displayName": "period",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "priority",
              "displayName": "priority",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "task_id",
              "displayName": "task_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "error_message",
              "displayName": "error_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "f6b856b1-91c9-4b5d-9553-2699d6b34a39",
      "name": "–î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1120,
        96
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "-1003503638426",
        "text": "=üìã <b>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö</b>\n\n–î–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥—å: {{ $json.length || 1 }}\n\n–ü–µ—Ä–∏–æ–¥—ã: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–µ—Å—è—Ü–µ–≤\n\n‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –º–∞–∫—Å. 4 —Å–∞–π—Ç–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "0d051d82-662e-43b9-a4ac-1a403b04e689",
      "name": "Telegram: –ó–∞–¥–∞—á–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1376,
        96
      ],
      "webhookId": "14ccabb4-4ded-4a6c-a9e1-0c3bb571fb6a",
      "credentials": {
        "telegramApi": {
          "id": "mHbM43fsaWN90avF",
          "name": "I.Redin - ws tg log"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 807869987,
          "mode": "list",
          "cachedResultName": "–û—á–µ—Ä–µ–¥—å",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=807869987"
        },
        "options": {}
      },
      "id": "4be8d998-5720-4df5-9318-efa1c9836741",
      "name": "–ß–∏—Ç–∞–µ–º –æ—á–µ—Ä–µ–¥—å",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        240,
        528
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "filter-pending-queue",
              "leftValue": "={{ $json.status }}",
              "rightValue": "pending",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "1969d3e6-b6bd-4220-a213-0c9fea462961",
      "name": "Filter: –¢–æ–ª—å–∫–æ pending",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        464,
        528
      ]
    },
    {
      "parameters": {
        "jsCode": "// –ë–µ—Ä—ë–º –¥–æ 9 –∑–∞–¥–∞—á –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ä–∞–Ω–¥–æ–º–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏\nconst items = $input.all();\n\nif (items.length === 0) {\n  return [];\n}\n\n// –ë–µ—Ä—ë–º –º–∞–∫—Å–∏–º—É–º 9 –∑–∞–¥–∞—á (–ª–∏–º–∏—Ç Browse AI –≤ —á–∞—Å)\nconst tasksToProcess = items.slice(0, 9);\n\n// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Å–µ–≤–¥–æ-—Ä–∞–Ω–¥–æ–º–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ (3-7 –º–∏–Ω—É—Ç –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏)\nconst tasks = tasksToProcess.map((item, index) => {\n  // –ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 3-4 –º–∏–Ω—É—Ç—ã + —Ä–∞–Ω–¥–æ–º 0-3 –º–∏–Ω—É—Ç—ã\n  const baseDelay = 180 + Math.floor(Math.random() * 60); // 180-240 —Å–µ–∫\n  const randomExtra = Math.floor(Math.random() * 180); // 0-180 —Å–µ–∫\n  const delaySeconds = baseDelay + randomExtra; // 180-420 —Å–µ–∫ (3-7 –º–∏–Ω)\n  \n  // –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏\n  const cumulativeDelay = index * delaySeconds;\n  \n  return {\n    json: {\n      ...item.json,\n      taskIndex: index,\n      delaySeconds: cumulativeDelay,\n      delayMinutes: Math.round(cumulativeDelay / 60),\n      scheduledAt: new Date(Date.now() + cumulativeDelay * 1000).toISOString()\n    }\n  };\n});\n\nconsole.log(`Processing ${tasks.length} tasks with random delays`);\n\nreturn tasks;"
      },
      "id": "653d8084-4808-40d6-bac1-c521f7d04c64",
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–¥–∞—á (–º–∞–∫—Å 9)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        528
      ]
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ä–æ–±–æ—Ç–æ–≤ v4\n// v4: –î–æ–±–∞–≤–ª–µ–Ω Marketing Channels Robot\nconst input = $input.first().json;\n\nconst sites = input.sites_list.split(\",\");\n\nif (sites.length > 5) {\n  console.warn(`WARNING: Too many sites (${sites.length}), truncating to 5`);\n  sites.length = 5;\n}\n\nconst sitesParam = sites.map(s => s.trim()).join(\",\");\nconst queueId = input.queue_id;\n// –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø–µ—Ä–∏–æ–¥: 2025.2 -> 2025.02 (Google Sheets –º–æ–∂–µ—Ç —É–±—Ä–∞—Ç—å –≤–µ–¥—É—â–∏–π –Ω–æ–ª—å)\nconst rawPeriod = String(input.period);\nconst [year, month] = rawPeriod.split('.');\nconst period = `${year}.${month.padStart(2, '0')}`;\n\n// URL –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–æ–±–æ—Ç–∞\n// Performance - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ website-performance\nconst performanceUrl = `https://pro.similarweb.com/#/digitalsuite/websiteanalysis/overview/website-performance/*/804/${period}-${period}?webSource=Total&key=${sitesParam}&qid=${queueId}`;\n// Marketing Channels - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ traffic-overview (–¥—Ä—É–≥–æ–π –ø—É—Ç—å –∏ —Ñ–æ—Ä–º–∞—Ç URL!)\nconst marketingChannelsUrl = `https://pro.similarweb.com/?#/digitalsuite/websiteanalysis/traffic-overview/*/804/${period}-${period}/?webSource=Total&key=${sitesParam}`;\n// AI Traffic - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ai-traffic\nconst aiTrafficUrl = `https://pro.similarweb.com/#/digitalsuite/ai-traffic/overview/*/804/${period}-${period}?webSource=Total&key=${sitesParam}&qid=${queueId}`;\n\nreturn [{\n  json: {\n    ...input,\n    performanceUrl,\n    marketingChannelsUrl,\n    aiTrafficUrl,\n    sites: sitesParam,\n    sitesCount: sites.length,\n    period,\n    queueId\n  }\n}];"
      },
      "id": "d4b2714a-4e2a-4eae-99f2-b22ff0ae5bcc",
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ URL",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1120,
        528
      ]
    },
    {
      "parameters": {
        "amount": "={{ $json.delaySeconds }}"
      },
      "id": "77b9c208-e53c-4ddd-b1f0-14508158d1f5",
      "name": "–†–∞–Ω–¥–æ–º–Ω–∞—è –ø–∞—É–∑–∞",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        896,
        528
      ],
      "webhookId": "b9f86f03-61de-46cd-a25e-ed2b0eefd1b5"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 807869987,
          "mode": "list",
          "cachedResultName": "–û—á–µ—Ä–µ–¥—å",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=807869987"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "queue_id"
          ],
          "schema": [
            {
              "id": "queue_id",
              "displayName": "queue_id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "736f8480-5c35-4fba-a16f-e165633fa376",
      "name": "–°—Ç–∞—Ç—É—Å: processing",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1344,
        528
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.browse.ai/v2/robots/019be626-b575-7d4b-a848-beee91c6d7aa/tasks",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"inputParameters\": {\n    \"originUrl\": \"{{ $('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ URL').first().json.performanceUrl }}\"\n  }\n}",
        "options": {}
      },
      "id": "4db97b36-3834-411e-b072-fb871d93b1fb",
      "name": "–ó–∞–ø—É—Å–∫ Performance Robot",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1568,
        528
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "4IkSClA1cWUZRGFP",
          "name": "Browse AI 2.1"
        }
      }
    },
    {
      "parameters": {
        "amount": 40
      },
      "id": "d192014c-7c9d-4846-8a11-671ff18d379d",
      "name": "–ñ–¥—ë–º Performance",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1776,
        528
      ],
      "webhookId": "c7dd6269-f291-40a4-a5fb-720e598e2f66"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.browse.ai/v2/robots/019bfb8d-58f6-7a2e-9b44-04e1fcf9fc26/tasks",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"inputParameters\": {\n    \"originUrl\": \"{{ $('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ URL').first().json.marketingChannelsUrl }}\"\n  }\n}",
        "options": {}
      },
      "id": "mc-robot-0001-0001-0001-000000000001",
      "name": "–ó–∞–ø—É—Å–∫ Marketing Channels Robot",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2000,
        528
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "4IkSClA1cWUZRGFP",
          "name": "Browse AI 2.1"
        }
      }
    },
    {
      "parameters": {
        "amount": 40
      },
      "id": "mc-wait-0001-0001-0001-000000000001",
      "name": "–ñ–¥—ë–º Marketing Channels",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2224,
        528
      ],
      "webhookId": "mc-wait-webhook-id"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.browse.ai/v2/robots/019be633-e05e-757a-aced-1cb415907f85/tasks",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"inputParameters\": {\n    \"originUrl\": \"{{ $('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ URL').first().json.aiTrafficUrl }}\"\n  }\n}",
        "options": {}
      },
      "id": "482e9e1c-93f9-4a33-a206-dbc01ece6e49",
      "name": "–ó–∞–ø—É—Å–∫ AI Traffic Robot",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2448,
        528
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "4IkSClA1cWUZRGFP",
          "name": "Browse AI 2.1"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "browse-ai-performance",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "4ace39dc-5c32-4679-841b-fe1a01a80ba1",
      "name": "Webhook: Performance Results",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        16,
        928
      ],
      "webhookId": "browse-ai-performance"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "browse-ai-marketing-channels",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "mc-webhook-0001-0001-0001-00000001",
      "name": "Webhook: Marketing Channels Results",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        16,
        1728
      ],
      "webhookId": "browse-ai-marketing-channels"
    },
    {
      "parameters": {
        "jsCode": "// –ü–∞—Ä—Å–µ—Ä Marketing Channels v1.0\n// –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª–æ–≤: Direct, Organic Search, Paid Search, Display Ads, Social, Email\nconst input = $input.first().json;\n\nconst body = input.body || input;\nconst taskStatus = body?.task?.status || input.taskStatus;\n\nif (taskStatus !== 'successful' && taskStatus !== 'completed') {\n  return [{ json: { error: 'Task not successful', taskStatus, sheetsRows: [] } }];\n}\n\nconst rawData = body?.task?.capturedTexts || {};\nconst taskId = body?.task?.id || input.taskId || 'unknown';\nconst originUrl = body?.task?.inputParameters?.originUrl || input.originUrl || '';\n\nconst keyMatch = originUrl.match(/key=([^&]+)/);\nlet sitesFromUrl = [];\nif (keyMatch) {\n  sitesFromUrl = decodeURIComponent(keyMatch[1]).split(',');\n}\nconst clientSite = sitesFromUrl[0] || '';\n\nconst qidMatch = originUrl.match(/qid=([^&]+)/);\nconst queueId = qidMatch ? qidMatch[1] : '';\n\nlet periodFormatted = '';\nconst periodUrlMatch = originUrl.match(/\\/804\\/(\\d{4}\\.\\d{1,2})-\\d{4}\\.\\d{1,2}/);\nif (periodUrlMatch) {\n  const [y, m] = periodUrlMatch[1].split('.');\n  periodFormatted = y + '.' + m.padStart(2, '0');\n}\nif (!periodFormatted && queueId) {\n  const queuePeriodMatch = queueId.match(/_(\\d{4}\\.\\d{1,2})_/);\n  if (queuePeriodMatch) {\n    const [y, m] = queuePeriodMatch[1].split('.');\n    periodFormatted = y + '.' + m.padStart(2, '0');\n  }\n}\nif (!periodFormatted) {\n  // Fallback: –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ key —á–µ—Ä–µ–∑ sitesFromUrl\n  const now = new Date();\n  periodFormatted = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}`;\n}\n\nlet data = {};\nif (Array.isArray(rawData)) {\n  rawData.forEach(item => {\n    const key = item.name || item.key;\n    const value = item.newText || item.text || item.value;\n    if (key && value) data[key] = value;\n  });\n} else {\n  data = rawData;\n}\n\nfunction extractLegendData(html) {\n  if (!html) return {};\n  const sites = {};\n  const patterns = [\n    /data-automation-title=\"true\"[^>]*>([^<]+)<\\/label>[\\s\\S]*?data-automation-value=\"true\"[^>]*>([^<]+)<\\/label>/g,\n    /class=\"[^\"]*iUaIjL[^\"]*\">([^<]+)<\\/label>[\\s\\S]{0,300}?class=\"[^\"]*gzsEum[^\"]*\">([^<]+)<\\/label>/g\n  ];\n  patterns.forEach(pattern => {\n    let match;\n    while ((match = pattern.exec(html)) !== null) {\n      const site = match[1].trim();\n      const value = match[2].trim();\n      if (site && value && site.includes('.') && /^[a-zA-Z0-9]/.test(site)) {\n        if (!sites[site]) sites[site] = value;\n      }\n    }\n  });\n  return sites;\n}\n\nconst direct = extractLegendData(data['Direct']);\nconst organicSearch = extractLegendData(data['Organic Search']);\nconst paidSearch = extractLegendData(data['Paid Search']);\nconst displayAds = extractLegendData(data['Display Ads'] || data['Display Search']);\nconst social = extractLegendData(data['Social'] || data['Sosial']);\nconst email = extractLegendData(data['Email']);\n\nconst today = new Date().toISOString().split('T')[0];\n\nconst allSites = new Set();\n[direct, organicSearch, paidSearch, displayAds, social, email].forEach(channel => {\n  Object.keys(channel).forEach(site => allSites.add(site));\n});\nif (allSites.size === 0 && sitesFromUrl.length > 0) {\n  sitesFromUrl.forEach(site => allSites.add(site));\n}\n\nconst sitesArray = Array.from(allSites);\n\nconst sheetsRows = sitesArray.map((site) => ({\n  'date': today,\n  'period': periodFormatted,\n  'client_site': clientSite,\n  'site': site,\n  'type': site === clientSite ? 'client' : 'competitor',\n  'Monthly Visits': '',\n  'Unique Visitors': '',\n  'Visit Duration': '',\n  'Pages/Visit': '',\n  'Bounce Rate': '',\n  'Direct': direct[site] || '',\n  'Organic Search': organicSearch[site] || '',\n  'Paid Search': paidSearch[site] || '',\n  'Display Ads': displayAds[site] || '',\n  'Social': social[site] || '',\n  'Email': email[site] || '',\n  'AI Traffic': '',\n  'Task ID': taskId,\n  'Queue ID': queueId,\n  'key': `${periodFormatted}_${site}`\n}));\n\nreturn [{\n  json: {\n    taskId,\n    queueId,\n    type: 'marketing_channels',\n    periodFormatted,\n    clientSite,\n    channels: { direct, organicSearch, paidSearch, displayAds, social, email },\n    sheetsRows,\n    sitesCount: sitesArray.length,\n    raw: data\n  }\n}];\n"
      },
      "id": "mc-parser-0001-0001-0001-00000001",
      "name": "Parse Marketing Channels Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        240,
        1728
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "sheetsRows",
        "options": {}
      },
      "id": "mc-split-0001-0001-0001-00000001",
      "name": "Split Out: Marketing Channels",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        464,
        1728
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "id",
          "cachedResultName": "–ö–ª–∏–µ–Ω—Ç—ã"
        },
        "options": {}
      },
      "id": "mc-clients-0001-0001-0001-0001",
      "name": "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è MC",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        688,
        1728
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è Marketing Channels –≤ —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞\nconst clients = $('–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è MC').all();\nconst mcRows = $('Split Out: Marketing Channels').all();\n\nconst clientMap = new Map();\nclients.forEach(c => {\n  if (c.json.client_site && c.json.spreadsheet_id) {\n    clientMap.set(c.json.client_site, c.json.spreadsheet_id);\n  }\n});\n\nconst output = [];\nmcRows.forEach(row => {\n  const clientSite = row.json.client_site;\n  const spreadsheetId = clientMap.get(clientSite);\n  if (spreadsheetId) {\n    output.push({ json: { ...row.json, _spreadsheet_id: spreadsheetId } });\n  }\n});\n\nreturn output.length > 0 ? output : [{ json: { noClientData: true } }];"
      },
      "id": "mc-routing-0001-0001-0001-0001",
      "name": "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è MC –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        912,
        1728
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "has-mc-client-data",
              "leftValue": "={{ $json.noClientData }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "mc-filter-0001-0001-0001-0001",
      "name": "–ï—Å—Ç—å MC –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        1136,
        1728
      ]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json._spreadsheet_id }}/values/–î–∞–Ω–Ω—ã–µ!A:T",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "options": {}
      },
      "id": "mc-read-0001-0001-0001-0001",
      "name": "–ß–∏—Ç–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è MC upsert",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1360,
        1728
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Upsert –ª–æ–≥–∏–∫–∞ Marketing Channels\nconst inputData = $('–ï—Å—Ç—å MC –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?').all();\nconst sheetResponse = $input.first().json;\nconst sheetValues = sheetResponse.values || [];\nconst spreadsheetId = inputData[0]?.json._spreadsheet_id;\n\n// –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–∏–æ–¥–∞: 2025.2 -> 2025.02\nfunction normPeriod(p) {\n  const s = String(p || '');\n  const parts = s.split('.');\n  if (parts.length === 2) return parts[0] + '.' + parts[1].padStart(2, '0');\n  return s;\n}\n\nconst existingRows = new Map();\nfor (let i = 1; i < sheetValues.length; i++) {\n  const row = sheetValues[i];\n  const period = normPeriod(row[1]);\n  const site = row[3] || '';\n  const key = `${period}_${site}`;\n  existingRows.set(key, { rowIndex: i + 1, rowData: row });\n}\n\nconst results = [];\nfor (const item of inputData) {\n  const row = item.json;\n  const key = `${normPeriod(row.period)}_${row.site}`;\n  const existing = existingRows.get(key);\n  \n  const newRowData = [\n    row.date || '', row.period || '', row.client_site || '', row.site || '', row.type || '',\n    row['Monthly Visits'] || '', row['Unique Visitors'] || '', row['Visit Duration'] || '',\n    row['Pages/Visit'] || '', row['Bounce Rate'] || '', row.Direct || '',\n    row['Organic Search'] || '', row['Paid Search'] || '', row['Display Ads'] || '',\n    row.Social || '', row.Email || '', row['AI Traffic'] || '',\n    row['Task ID'] || '', row['Queue ID'] || '', row.key || ''\n  ];\n  \n  if (existing) {\n    const mergedData = newRowData.map((newVal, idx) => {\n      if (newVal === '' && existing.rowData[idx]) return existing.rowData[idx];\n      return newVal;\n    });\n    results.push({ json: { action: 'update', spreadsheetId, rowIndex: existing.rowIndex, range: `–î–∞–Ω–Ω—ã–µ!A${existing.rowIndex}:T${existing.rowIndex}`, values: [mergedData] } });\n  } else {\n    results.push({ json: { action: 'append', spreadsheetId, values: [newRowData] } });\n  }\n}\n\nreturn results;\n"
      },
      "id": "mc-upsert-0001-0001-0001-0001",
      "name": "Upsert –ª–æ–≥–∏–∫–∞ MC",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1584,
        1728
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "is-mc-update",
              "leftValue": "={{ $json.action }}",
              "rightValue": "update",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "mc-if-0001-0001-0001-0001",
      "name": "MC Update –∏–ª–∏ Append?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1808,
        1728
      ]
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json.spreadsheetId }}/values/{{ $json.range }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "valueInputOption",
              "value": "USER_ENTERED"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ values: $json.values }) }}",
        "options": {}
      },
      "id": "mc-update-0001-0001-0001-0001",
      "name": "MC Update —Å—Ç—Ä–æ–∫—É",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2032,
        1628
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json.spreadsheetId }}/values/–î–∞–Ω–Ω—ã–µ!A:T:append",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "valueInputOption",
              "value": "USER_ENTERED"
            },
            {
              "name": "insertDataOption",
              "value": "INSERT_ROWS"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ values: $json.values }) }}",
        "options": {}
      },
      "id": "mc-append-0001-0001-0001-0001",
      "name": "MC Append —Å—Ç—Ä–æ–∫—É",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2032,
        1828
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á—ë—Ç –∏–∑ Marketing Channels –¥–∞–Ω–Ω—ã—Ö\nconst data = $('Parse Marketing Channels Data').first().json;\n\nlet report = 'üö¶ <b>Marketing Channels</b>\\n';\nreport += `üìÖ ${data.periodFormatted}\\n`;\nreport += `üë§ –ö–ª–∏–µ–Ω—Ç: ${data.clientSite}\\n\\n`;\n\nconst channels = data.channels;\nconst channelConfig = [\n  { key: 'direct', name: 'Direct', emoji: 'üîó' },\n  { key: 'organicSearch', name: 'Organic Search', emoji: 'üîç' },\n  { key: 'paidSearch', name: 'Paid Search', emoji: 'üí∞' },\n  { key: 'displayAds', name: 'Display Ads', emoji: 'üì∫' },\n  { key: 'social', name: 'Social', emoji: 'üì±' },\n  { key: 'email', name: 'Email', emoji: 'üìß' }\n];\n\nchannelConfig.forEach(({ key, name, emoji }) => {\n  const channelData = channels[key];\n  if (channelData && Object.keys(channelData).length > 0) {\n    report += `${emoji} <b>${name}</b>\\n`;\n    Object.entries(channelData).forEach(([site, value]) => {\n      const siteEmoji = site === data.clientSite ? 'üîµ' : 'üü†';\n      report += `   ${siteEmoji} ${site}: ${value}\\n`;\n    });\n    report += '\\n';\n  }\n});\n\nreport += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n';\nreport += '‚úÖ –ö–∞–Ω–∞–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã';\n\nreturn [{ json: { report, ...data } }];"
      },
      "id": "mc-report-0001-0001-0001-0001",
      "name": "Format MC Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        464,
        1904
      ]
    },
    {
      "parameters": {
        "chatId": "-1003503638426",
        "text": "={{ $json.report }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "mc-telegram-0001-0001-0001-0001",
      "name": "Telegram: Marketing Channels",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        688,
        1904
      ],
      "credentials": {
        "telegramApi": {
          "id": "mHbM43fsaWN90avF",
          "name": "I.Redin - ws tg log"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "browse-ai-aitraffic",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "6787af06-960c-4788-aaac-d163c6b6a281",
      "name": "Webhook: AI Traffic Results",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        16,
        1328
      ],
      "webhookId": "browse-ai-aitraffic"
    },
    {
      "parameters": {
        "jsCode": "// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏\nconst input = $input.first().json;\n\nconst taskStatus = input.body?.task?.status || input.status;\nconst taskId = input.body?.task?.id || 'unknown';\nconst finishedAt = input.body?.task?.finishedAt;\nconst robotId = input.body?.robot?.id || 'unknown';\nconst originUrl = input.body?.task?.inputParameters?.originUrl || '';\n\n// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ä–æ–±–æ—Ç–∞\nconst isPerformance = originUrl.includes('website-performance');\nconst robotType = isPerformance ? 'Performance' : 'AI Traffic';\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ URL\nconst keyMatch = originUrl.match(/key=([^&]+)/);\nlet sites = [];\nif (keyMatch) {\n  sites = decodeURIComponent(keyMatch[1]).split(',');\n}\n\nconst periodMatch = originUrl.match(/\\/804\\/(\\d{4}\\.\\d{2})-/);\nconst period = periodMatch ? periodMatch[1] : 'unknown';\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å\nconst isSuccess = (taskStatus === 'successful' || taskStatus === 'completed') && finishedAt;\n\nif (!isSuccess) {\n  // –ó–∞–¥–∞—á–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å - –ª–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É\n  // –ü–æ–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∫–æ–ª–æ–Ω–∫–∞–º –≤ —Ç–∞–±–ª–∏—Ü–µ \"–õ–æ–≥–∏ –æ—à–∏–±–æ–∫\"\n  return [{\n    json: {\n      isError: true,\n      timestamp: new Date().toISOString().replace('T', ' ').substring(0, 19),\n      task_id: taskId,\n      robot_type: robotType,\n      period: period,\n      sites: sites.join(','),\n      status: taskStatus || 'failed',\n      error_message: input.body?.task?.failedReason || 'Unknown error',\n      url: originUrl,\n      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏\n      taskId,\n      taskStatus,\n      robotType,\n      originUrl\n    }\n  }];\n}\n\n// –ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–∞ - –ø–µ—Ä–µ–¥–∞—ë–º –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É\nreturn [{\n  json: {\n    isError: false,\n    taskId,\n    taskStatus,\n    robotType,\n    period,\n    sites,\n    originUrl,\n    body: input.body\n  }\n}];"
      },
      "id": "2b040f47-f893-4c96-bcf8-1ddcc5f90364",
      "name": "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        240,
        928
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "is-error",
              "leftValue": "={{ $json.isError }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "d5a26790-1297-4843-87d8-5c6f3e8e98e5",
      "name": "–û—à–∏–±–∫–∞ –∏–ª–∏ —É—Å–ø–µ—Ö?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        464,
        928
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1263404191,
          "mode": "list",
          "cachedResultName": "–õ–æ–≥–∏ –æ—à–∏–±–æ–∫",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=1263404191"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "task_id",
              "displayName": "task_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "robot_type",
              "displayName": "robot_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "period",
              "displayName": "period",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "sites",
              "displayName": "sites",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "error_message",
              "displayName": "error_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "b8ad290e-3517-4b06-b176-07d0cab49804",
      "name": "–õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        688,
        800
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "-1003503638426",
        "text": "=‚ùå <b>–û—à–∏–±–∫–∞ —Ä–æ–±–æ—Ç–∞</b>\n\nü§ñ –†–æ–±–æ—Ç: {{ $json.robotType }}\nüìÖ –ü–µ—Ä–∏–æ–¥: {{ $json.period }}\nüåê –°–∞–π—Ç—ã: {{ $json.sites }}\n\n‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: {{ $json.taskStatus }}\nüìù –û—à–∏–±–∫–∞: {{ $json.errorMessage }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "a8dcf2b4-b766-4c7a-8a15-82532cdcb80c",
      "name": "Telegram: –û—à–∏–±–∫–∞",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        896,
        800
      ],
      "webhookId": "b91bfe06-5918-49cb-bcc5-ec2a0c38b614",
      "credentials": {
        "telegramApi": {
          "id": "mHbM43fsaWN90avF",
          "name": "I.Redin - ws tg log"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–∞—Ä—Å–µ—Ä Performance –¥–∞–Ω–Ω—ã—Ö v4.0\n// v4: –¢–æ–ª—å–∫–æ Engagement –¥–∞–Ω–Ω—ã–µ (–∫–∞–Ω–∞–ª—ã –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ Marketing Channels Robot)\nconst input = $input.first().json;\n\nconst body = input.body || input;\nconst rawData = body?.task?.capturedTexts || {};\nconst taskId = body?.task?.id || input.taskId || 'unknown';\nconst originUrl = body?.task?.inputParameters?.originUrl || input.originUrl || '';\nconst inputSites = input.sites || [];\n\nconst keyMatch = originUrl.match(/key=([^&]+)/);\nlet sitesFromUrl = [];\nif (keyMatch) {\n  sitesFromUrl = decodeURIComponent(keyMatch[1]).split(',');\n}\nconst clientSite = sitesFromUrl[0] || '';\n\nconst qidMatch = originUrl.match(/qid=([^&]+)/);\nconst queueId = qidMatch ? qidMatch[1] : '';\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–µ—Ä–∏–æ–¥ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\nlet periodFormatted = '';\nconst periodUrlMatch = originUrl.match(/\\/804\\/(\\d{4}\\.\\d{1,2})-\\d{4}\\.\\d{1,2}/);\nif (periodUrlMatch) {\n  const [y, m] = periodUrlMatch[1].split('.');\n  periodFormatted = y + '.' + m.padStart(2, '0');\n}\nif (!periodFormatted && queueId) {\n  const queuePeriodMatch = queueId.match(/_(\\d{4}\\.\\d{1,2})_/);\n  if (queuePeriodMatch) {\n    const [y, m] = queuePeriodMatch[1].split('.');\n    periodFormatted = y + '.' + m.padStart(2, '0');\n  }\n}\nif (!periodFormatted) {\n  const now = new Date();\n  periodFormatted = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}`;\n}\n\nlet data = {};\nif (Array.isArray(rawData)) {\n  rawData.forEach(item => {\n    const key = item.name || item.key;\n    const value = item.newText || item.text || item.value;\n    if (key && value) data[key] = value;\n  });\n} else {\n  data = rawData;\n}\n\nfunction isLoading(html) {\n  if (!html) return true;\n  return html.includes('LoadingContainer') || html.includes('linearGradient id=\"lineGray\"');\n}\n\nfunction extractEngagementData(html) {\n  if (!html || isLoading(html)) return null;\n  const result = {};\n  const domainPattern = /DomainWrapper[^>]*>\\s*([a-zA-Z0-9][a-zA-Z0-9.-]*\\.[a-zA-Z]{2,})\\s*<\\/span>/g;\n  const domains = [];\n  let match;\n  while ((match = domainPattern.exec(html)) !== null) {\n    domains.push(match[1].trim());\n  }\n  if (domains.length === 0) return null;\n  domains.forEach(domain => {\n    const cellRegex = new RegExp(\n      'data-automation=\"MiniFlexTable-cell ' + domain.replace(/\\./g, '\\\\.') + '\"[\\\\s\\\\S]*?<span[^>]*class=\"[^\"]*value[^\"]*\"[^>]*>([\\\\s\\\\S]*?)</span>',\n      'g'\n    );\n    const values = [];\n    let cellMatch;\n    while ((cellMatch = cellRegex.exec(html)) !== null) {\n      let val = cellMatch[1].replace(/<svg[\\s\\S]*?<\\/svg>/g, '').replace(/<div[\\s\\S]*?<\\/div>/g, '').replace(/<[^>]+>/g, '').trim();\n      if (val) values.push(val);\n    }\n    if (values.length >= 5) {\n      result[domain] = {\n        monthlyVisits: values[0] || '',\n        uniqueVisitors: values[1] || '',\n        visitsPerVisitor: values[2] || '',\n        deduplicatedAudience: values[3] || '',\n        visitDuration: values[4] || '',\n        pagesPerVisit: values[5] || '',\n        bounceRate: values[6] || '',\n        pageViews: values[7] || ''\n      };\n    }\n  });\n  return Object.keys(result).length > 0 ? result : null;\n}\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º Engagement –∏–∑ –æ–±–æ–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\nlet engagement = null;\nif (!isLoading(data['Engagement'])) {\n  engagement = extractEngagementData(data['Engagement']);\n}\nif (!engagement && data['Engagement 2']) {\n  engagement = extractEngagementData(data['Engagement 2']);\n}\n\nconst today = new Date().toISOString().split('T')[0];\n\n// –°–æ–±–∏—Ä–∞–µ–º —Å–∞–π—Ç—ã —Ç–æ–ª—å–∫–æ –∏–∑ Engagement\nconst allSites = new Set();\nif (engagement) {\n  Object.keys(engagement).forEach(site => allSites.add(site));\n}\nif (allSites.size === 0 && sitesFromUrl.length > 0) {\n  sitesFromUrl.forEach(site => allSites.add(site));\n}\nif (allSites.size === 0 && inputSites.length > 0) {\n  inputSites.forEach(site => allSites.add(site));\n}\n\nconst sitesArray = Array.from(allSites);\n\n// v4: –¢–æ–ª—å–∫–æ Engagement –º–µ—Ç—Ä–∏–∫–∏ (–∫–∞–Ω–∞–ª—ã –ø—É—Å—Ç—ã–µ - –∑–∞–ø–æ–ª–Ω—è—Ç—Å—è –∏–∑ Marketing Channels)\nconst sheetsRows = sitesArray.map((site) => {\n  const eng = engagement?.[site] || {};\n  return {\n    'date': today,\n    'period': periodFormatted,\n    'client_site': clientSite,\n    'site': site,\n    'type': site === clientSite ? 'client' : 'competitor',\n    'Monthly Visits': eng.monthlyVisits || '',\n    'Unique Visitors': eng.uniqueVisitors || '',\n    'Visit Duration': eng.visitDuration || '',\n    'Pages/Visit': eng.pagesPerVisit || '',\n    'Bounce Rate': eng.bounceRate || '',\n    'Direct': '',\n    'Organic Search': '',\n    'Paid Search': '',\n    'Display Ads': '',\n    'Social': '',\n    'Email': '',\n    'Task ID': taskId,\n    'Queue ID': queueId,\n    'key': `${periodFormatted}_${site}`\n  };\n});\n\nreturn [{\n  json: {\n    taskId,\n    queueId,\n    type: 'performance',\n    periodFormatted,\n    clientSite,\n    engagement,\n    sheetsRows,\n    sitesCount: sitesArray.length,\n    raw: data\n  }\n}];\n"
      },
      "id": "c2ce219d-507c-4ff5-8b2f-c258da680ca1",
      "name": "Parse Performance Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        1040
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "sheetsRows",
        "options": {}
      },
      "id": "0f4f9ca9-e43d-463a-a25d-37e69ec4f3a3",
      "name": "Split Out: Performance",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        896,
        1040
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "id",
          "cachedResultName": "–ö–ª–∏–µ–Ω—Ç—ã"
        },
        "options": {}
      },
      "id": "jj000000-0000-0000-0000-000000000001",
      "name": "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1120,
        1320
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞\nconst clients = $('–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã').all();\nconst performanceRows = $('Split Out: Performance').all();\n\n// –°–æ–∑–¥–∞—ë–º –º–∞–ø—É client_site -> spreadsheet_id\nconst clientMap = new Map();\nclients.forEach(c => {\n  if (c.json.client_site && c.json.spreadsheet_id) {\n    clientMap.set(c.json.client_site, c.json.spreadsheet_id);\n  }\n});\n\n// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º\nconst resultsByClient = new Map();\n\nperformanceRows.forEach(row => {\n  const clientSite = row.json.client_site;\n  const spreadsheetId = clientMap.get(clientSite);\n  \n  if (spreadsheetId) {\n    if (!resultsByClient.has(clientSite)) {\n      resultsByClient.set(clientSite, {\n        spreadsheet_id: spreadsheetId,\n        rows: []\n      });\n    }\n    resultsByClient.get(clientSite).rows.push(row.json);\n  }\n});\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—ã –∫–ª–∏–µ–Ω—Ç–æ–≤\nconst output = [];\nresultsByClient.forEach((data, clientSite) => {\n  data.rows.forEach(row => {\n    output.push({\n      json: {\n        ...row,\n        _spreadsheet_id: data.spreadsheet_id\n      }\n    });\n  });\n});\n\nreturn output.length > 0 ? output : [{ json: { noClientData: true } }];"
      },
      "id": "jj000000-0000-0000-0000-000000000002",
      "name": "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1344,
        1320
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "has-client-data",
              "leftValue": "={{ $json.noClientData }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "jj000000-0000-0000-0000-000000000003",
      "name": "–ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        1568,
        1320
      ]
    },
    {
      "parameters": {
        "jsCode": "// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –æ—á–µ—Ä–µ–¥–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\nconst performanceData = $('Parse Performance Data').first().json;\nconst originUrl = $('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏').first().json.originUrl || '';\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º queue_id –∏–∑ URL\nconst qidMatch = originUrl.match(/qid=([^&]+)/);\nconst queueId = qidMatch ? decodeURIComponent(qidMatch[1]) : '';\n\nconst now = new Date().toISOString().replace('T', ' ').substring(0, 19);\n\nreturn [{\n  json: {\n    queue_id: queueId,\n    status: 'done',\n    task_id: performanceData.taskId\n  }\n}];"
      },
      "id": "c792cf9c-2878-4b26-8ccb-5ebf399da95a",
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1344,
        1040
      ]
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á—ë—Ç –∏–∑ Performance –¥–∞–Ω–Ω—ã—Ö v4.0\n// v4: –¢–æ–ª—å–∫–æ Engagement (–∫–∞–Ω–∞–ª—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ä–æ–±–æ—Ç–µ)\nconst data = $('Parse Performance Data').first().json;\n\nlet report = 'üìä <b>SimilarWeb Engagement</b>\\n';\nreport += `üìÖ ${data.periodFormatted}\\n`;\nreport += `üë§ –ö–ª–∏–µ–Ω—Ç: ${data.clientSite}\\n\\n`;\n\nconst engagement = data.engagement;\nif (engagement && Object.keys(engagement).length > 0) {\n  report += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n';\n  report += 'üìà <b>ENGAGEMENT</b>\\n';\n  report += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n\\n';\n  \n  Object.entries(engagement).forEach(([site, metrics], idx) => {\n    const siteEmoji = site === data.clientSite ? 'üîµ' : 'üü†';\n    report += `${siteEmoji} <b>${site}</b>\\n`;\n    if (metrics.monthlyVisits) report += `   üìä Monthly Visits: ${metrics.monthlyVisits}\\n`;\n    if (metrics.uniqueVisitors) report += `   üë• Unique Visitors: ${metrics.uniqueVisitors}\\n`;\n    if (metrics.visitDuration) report += `   ‚è± Visit Duration: ${metrics.visitDuration}\\n`;\n    if (metrics.pagesPerVisit) report += `   üìÑ Pages/Visit: ${metrics.pagesPerVisit}\\n`;\n    if (metrics.bounceRate) report += `   üìâ Bounce Rate: ${metrics.bounceRate}\\n`;\n    report += '\\n';\n  });\n} else {\n  report += '‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö Engagement\\n';\n}\n\nreport += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n';\nreport += '‚úÖ Engagement —Å–æ—Ö—Ä–∞–Ω—ë–Ω';\n\nreturn [{\n  json: {\n    report,\n    ...data\n  }\n}];"
      },
      "id": "4a021a4f-7cab-4c2a-b95c-825217df8e53",
      "name": "Format Performance Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1120,
        1216
      ]
    },
    {
      "parameters": {
        "chatId": "-1003503638426",
        "text": "={{ $json.report }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "b78c405f-2ae4-48a6-be0f-361efa579c3e",
      "name": "Telegram: Performance",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1344,
        1216
      ],
      "webhookId": "d95e8d2d-b66c-4ced-a7fc-c90b43ce5a46",
      "credentials": {
        "telegramApi": {
          "id": "mHbM43fsaWN90avF",
          "name": "I.Redin - ws tg log"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–∞—Ä—Å–µ—Ä AI Traffic –¥–∞–Ω–Ω—ã—Ö v2.3\n// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\nconst input = $input.first().json;\n\nconst body = input.body || input;\nconst taskStatus = body?.task?.status || input.taskStatus;\nconst inputSites = input.sites || [];\n\n// Early return with proper format if not successful\nif (taskStatus !== 'successful' && taskStatus !== 'completed') {\n  return [{\n    json: {\n      error: 'Task not successful',\n      taskStatus,\n      sheetsRows: []\n    }\n  }];\n}\n\nconst rawData = body?.task?.capturedTexts || {};\nconst taskId = body?.task?.id || input.taskId || 'unknown';\nconst originUrl = body?.task?.inputParameters?.originUrl || input.originUrl || '';\n\nconst keyMatch = originUrl.match(/key=([^&]+)/);\nlet sitesFromUrl = [];\nif (keyMatch) {\n  sitesFromUrl = decodeURIComponent(keyMatch[1]).split(',');\n}\nconst clientSite = sitesFromUrl[0] || '';\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º queueId –¥–ª—è —Å–≤—è–∑–∫–∏ —Å –æ—á–µ—Ä–µ–¥—å—é\nconst qidMatch = originUrl.match(/qid=([^&]+)/);\nconst queueId = qidMatch ? qidMatch[1] : '';\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–µ—Ä–∏–æ–¥ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤\nlet periodFormatted = '';\n// 1. –ò–∑ URL —Ñ–æ—Ä–º–∞—Ç–∞ /804/2025.01- (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ 1 –∏ 2 —Ü–∏—Ñ—Ä –º–µ—Å—è—Ü–∞)\nconst periodUrlMatch = originUrl.match(/\\/804\\/(\\d{4}\\.\\d{1,2})-/);\nif (periodUrlMatch) {\n  const [y, m] = periodUrlMatch[1].split('.');\n  periodFormatted = y + '.' + m.padStart(2, '0');\n}\n// 2. –ò–∑ queueId —Ñ–æ—Ä–º–∞—Ç–∞ site_2025.01_chunk\nif (!periodFormatted && queueId) {\n  const queuePeriodMatch = queueId.match(/_(\\d{4}\\.\\d{1,2})_/);\n  if (queuePeriodMatch) {\n    const [y, m] = queuePeriodMatch[1].split('.');\n    periodFormatted = y + '.' + m.padStart(2, '0');\n  }\n}\n// 3. –¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –∫–∞–∫ fallback\nif (!periodFormatted) {\n  const now = new Date();\n  periodFormatted = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}`;\n}\n\nlet data = {};\nif (Array.isArray(rawData)) {\n  rawData.forEach(item => {\n    const key = item.name || item.key;\n    const value = item.newText || item.text || item.value;\n    if (key && value) data[key] = value;\n  });\n} else {\n  data = rawData;\n}\n\n// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö AI Traffic\nfunction extractLegendData(html) {\n  if (!html) return {};\n  const sites = {};\n\n  const patterns = [\n    // data-automation –∞—Ç—Ä–∏–±—É—Ç—ã (—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ)\n    /data-automation-title=\"true\"[^>]*>([^<]+)<\\/label>[\\s\\S]*?data-automation-value=\"true\"[^>]*>([^<]+)<\\/label>/gs,\n    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–ª–∞—Å—Å—ã SimilarWeb\n    /class=\"[^\"]*\"[^>]*>([a-zA-Z0-9][a-zA-Z0-9.-]+\\.[a-zA-Z]{2,})<\\/label>[\\s\\S]{0,200}?<label[^>]*class=\"[^\"]*\"[^>]*>([\\d,]+|N\\/A)<\\/label>/g,\n    // Fallback: label –ø–∞—Ä—ã —Å –¥–æ–º–µ–Ω–∞–º–∏\n    /<label[^>]*>([a-zA-Z0-9][a-zA-Z0-9.-]+\\.[a-zA-Z]{2,})<\\/label>[\\s\\S]{0,200}?<label[^>]*>([\\d,]+|N\\/A)<\\/label>/g\n  ];\n\n  patterns.forEach(pattern => {\n    let match;\n    while ((match = pattern.exec(html)) !== null) {\n      const site = match[1].trim();\n      const value = match[2].trim();\n      if (site && value && site.includes('.') && /^[a-zA-Z0-9]/.test(site)) {\n        if (!sites[site]) sites[site] = value;\n      }\n    }\n  });\n  return sites;\n}\n\nconst aiTraffic = extractLegendData(data['Avg Traffic']);\nconst today = new Date().toISOString().split('T')[0];\n\n// –°–æ–±–∏—Ä–∞–µ–º —Å–∞–π—Ç—ã —Å fallback\nconst allSites = Object.keys(aiTraffic);\nif (allSites.length === 0 && sitesFromUrl.length > 0) {\n  sitesFromUrl.forEach(site => allSites.push(site));\n}\nif (allSites.length === 0 && inputSites.length > 0) {\n  inputSites.forEach(site => allSites.push(site));\n}\n\n// –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–æ–∫–∏ (20 –∫–æ–ª–æ–Ω–æ–∫) - –∫–∞–∫ –≤ Performance –ø–∞—Ä—Å–µ—Ä–µ\nconst sheetsRows = allSites.map((site) => ({\n  'date': today,\n  'period': periodFormatted,\n  'client_site': clientSite,\n  'site': site,\n  'type': site === clientSite ? 'client' : 'competitor',\n  'Monthly Visits': '',\n  'Unique Visitors': '',\n  'Visit Duration': '',\n  'Pages/Visit': '',\n  'Bounce Rate': '',\n  'Direct': '',\n  'Organic Search': '',\n  'Paid Search': '',\n  'Display Ads': '',\n  'Social': '',\n  'Email': '',\n  'AI Traffic': aiTraffic[site] || 'N/A',\n  'Task ID': taskId,\n  'Queue ID': queueId,\n  'key': `${periodFormatted}_${site}`\n}));\n\nreturn [{\n  json: {\n    taskId,\n    queueId,\n    type: 'aitraffic',\n    clientSite,\n    periodFormatted,\n    aiTraffic,\n    sheetsRows,\n    sitesCount: allSites.length,\n    raw: data\n  }\n}];\n"
      },
      "id": "56daa802-3f0a-484a-a4f0-1581abab68ca",
      "name": "Parse AI Traffic Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        240,
        1328
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "sheetsRows",
        "options": {}
      },
      "id": "01d364b4-a16f-4757-8952-7f7bc652b036",
      "name": "Split Out: AI Traffic",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        464,
        1328
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "id",
          "cachedResultName": "–ö–ª–∏–µ–Ω—Ç—ã"
        },
        "options": {}
      },
      "id": "kk000000-0000-0000-0000-000000000005",
      "name": "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è AI",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        912,
        1328
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è AI Traffic –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞\nconst clients = $('–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è AI').all();\nconst aiRows = $('Split Out: AI Traffic').all();\n\n// –°–æ–∑–¥–∞—ë–º –º–∞–ø—É client_site -> spreadsheet_id\nconst clientMap = new Map();\nclients.forEach(c => {\n  if (c.json.client_site && c.json.spreadsheet_id) {\n    clientMap.set(c.json.client_site, c.json.spreadsheet_id);\n  }\n});\n\n// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º\nconst output = [];\n\naiRows.forEach(row => {\n  const clientSite = row.json.client_site;\n  const spreadsheetId = clientMap.get(clientSite);\n  \n  if (spreadsheetId) {\n    output.push({\n      json: {\n        ...row.json,\n        _spreadsheet_id: spreadsheetId\n      }\n    });\n  }\n});\n\nreturn output.length > 0 ? output : [{ json: { noClientData: true } }];"
      },
      "id": "kk000000-0000-0000-0000-000000000006",
      "name": "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è AI –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1136,
        1328
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "has-ai-client-data",
              "leftValue": "={{ $json.noClientData }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "kk000000-0000-0000-0000-000000000007",
      "name": "–ï—Å—Ç—å AI –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        1360,
        1328
      ]
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á—ë—Ç –∏–∑ AI Traffic –¥–∞–Ω–Ω—ã—Ö\nconst data = $('Parse AI Traffic Data').first().json;\n\nlet report = 'ü§ñ <b>AI TRAFFIC</b>\\n';\nreport += `üìÖ ${data.periodFormatted}\\n`;\nreport += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n\\n';\n\nconst aiTraffic = data.aiTraffic || {};\n\nif (Object.keys(aiTraffic).length > 0) {\n  Object.entries(aiTraffic).forEach(([site, value], idx) => {\n    const emoji = idx === 0 ? 'üîµ' : idx === 1 ? 'üü†' : idx === 2 ? 'üü¢' : 'üü°';\n    report += `${emoji} ${site}: <b>${value}</b>\\n`;\n  });\n} else {\n  report += '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ AI Traffic\\n';\n}\n\nreport += '\\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n';\nreport += '‚úÖ AI Traffic —Å–æ—Ö—Ä–∞–Ω—ë–Ω';\n\nreturn [{\n  json: {\n    report,\n    ...data\n  }\n}];"
      },
      "id": "bf059aa6-9054-4c56-8bc8-b383c8ca02e6",
      "name": "Format AI Traffic Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        1504
      ]
    },
    {
      "parameters": {
        "chatId": "-1003503638426",
        "text": "={{ $json.report }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "9f4d1389-7d54-4223-922c-aa320e750272",
      "name": "Telegram: AI Traffic",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        896,
        1504
      ],
      "webhookId": "47978784-7cd7-48fd-a4a1-b564e65c92ca",
      "credentials": {
        "telegramApi": {
          "id": "mHbM43fsaWN90avF",
          "name": "I.Redin - ws tg log"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 807869987,
          "mode": "list",
          "cachedResultName": "–û—á–µ—Ä–µ–¥—å",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=807869987"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "queue_id"
          ],
          "schema": [
            {
              "id": "queue_id",
              "displayName": "queue_id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "task_id",
              "displayName": "task_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "6cf86895-175e-432d-8259-09fff265593e",
      "name": "–û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏: done",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1568,
        1040
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ó–ê–î–ê–ß–ê ‚Ññ1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ Google Drive\n// –ò–∑–≤–ª–µ–∫–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ —Å–ø–∏—Å–∫–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤\nconst competitors = $('–ß–∏—Ç–∞–µ–º –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤').all();\n\n// –°–æ–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤\nconst uniqueClients = new Set();\ncompetitors.forEach(row => {\n  const client = row.json.client_site;\n  if (client) {\n    uniqueClients.add(client);\n  }\n});\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞–ø–æ–∫\nconst clients = Array.from(uniqueClients).map(client => ({\n  json: {\n    client_site: client,\n    folder_name: client // –ò–º—è –ø–∞–ø–∫–∏ = –∏–º—è —Å–∞–π—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞\n  }\n}));\n\nconsole.log(`Found ${clients.length} unique clients`);\nreturn clients;"
      },
      "id": "aa111111-1111-1111-1111-111111111111",
      "name": "–ò–∑–≤–ª–µ–∫–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        240,
        -272
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–ø–∫—É –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ Google Drive API\n// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤\nconst clientSite = $input.item.json.client_site;\nconst parentFolderId = '1Z069NZFgLq1zBS9EM3fKLFfkyq8BO1h9';\n\n// –ü–µ—Ä–µ–¥–∞—ë–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è HTTP Request –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º client_site –≤ output\nreturn {\n  client_site: clientSite,\n  folder_name: clientSite,\n  parent_folder_id: parentFolderId,\n  query: `mimeType='application/vnd.google-apps.folder' and name='${clientSite}' and '${parentFolderId}' in parents and trashed=false`\n};"
      },
      "id": "bb222222-2222-2222-2222-222222222222",
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ Drive",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        464,
        -272
      ]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://www.googleapis.com/drive/v3/files",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDriveOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "={{ $json.query }}"
            },
            {
              "name": "fields",
              "value": "files(id,name)"
            }
          ]
        },
        "options": {}
      },
      "id": "bb222222-2222-2222-2222-222222222223",
      "name": "–ü–æ–∏—Å–∫ –ø–∞–ø–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        688,
        -272
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞ –ø–∞–ø–∫–∏\nconst files = $input.item.json.files || [];\nconst clientSite = $('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ Drive').item.json.client_site;\n\nconst folderExists = files.length > 0;\nconst folderId = folderExists ? files[0].id : null;\n\nreturn {\n  client_site: clientSite,\n  folder_exists: folderExists,\n  folder_id: folderId,\n  folder_name: clientSite\n};"
      },
      "id": "cc333333-3333-3333-3333-333333333333",
      "name": "–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∏—Å–∫–∞",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        -272
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "folder-exists-check",
              "leftValue": "={{ $json.folder_exists }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "dd444444-4444-4444-4444-444444444444",
      "name": "–ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        896,
        -272
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://www.googleapis.com/drive/v3/files",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDriveOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"name\": \"{{ $json.folder_name }}\",\n  \"mimeType\": \"application/vnd.google-apps.folder\",\n  \"parents\": [\"1Z069NZFgLq1zBS9EM3fKLFfkyq8BO1h9\"]\n}",
        "options": {}
      },
      "id": "ee555555-5555-5555-5555-555555555555",
      "name": "–°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –∫–ª–∏–µ–Ω—Ç–∞",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1120,
        -352
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://www.googleapis.com/drive/v3/files",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDriveOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"name\": \"SimilarWeb Data - {{ $('–ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?').item.json.client_site }}\",\n  \"mimeType\": \"application/vnd.google-apps.spreadsheet\",\n  \"parents\": [\"{{ $json.id }}\"]\n}"
      },
      "id": "ff666666-6666-6666-6666-666666666666",
      "name": "–°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1344,
        -352
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "LKAQlCpSzzSEwEwA",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json.id }}:batchUpdate",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"requests\": [\n    {\n      \"addSheet\": {\n        \"properties\": {\n          \"title\": \"–î–∞–Ω–Ω—ã–µ\"\n        }\n      }\n    }\n  ]\n}"
      },
      "id": "hh888888-8888-8888-8888-888888888888",
      "name": "–°–æ–∑–¥–∞—ë–º –ª–∏—Å—Ç –î–∞–Ω–Ω—ã–µ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1456,
        -352
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $(\"–°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞\").item.json.id }}/values/–î–∞–Ω–Ω—ã–µ!A1:T1?valueInputOption=USER_ENTERED",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"values\": [[\n    \"date\",\n    \"period\",\n    \"client_site\",\n    \"site\",\n    \"type\",\n    \"Monthly Visits\",\n    \"Unique Visitors\",\n    \"Visit Duration\",\n    \"Pages/Visit\",\n    \"Bounce Rate\",\n    \"Direct\",\n    \"Organic Search\",\n    \"Paid Search\",\n    \"Display Ads\",\n    \"Social\",\n    \"Email\",\n    \"AI Traffic\",\n    \"Task ID\",\n    \"Queue ID\",\n    \"key\"\n  ]]\n}"
      },
      "id": "header-node-0001-0001-0001-000000000001",
      "name": "–ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1568,
        -352
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "id",
          "cachedResultName": "–ö–ª–∏–µ–Ω—Ç—ã"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "client_site": "={{ $('–ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?').item.json.client_site }}",
            "folder_id": "={{ $('–°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –∫–ª–∏–µ–Ω—Ç–∞').item.json.id }}",
            "spreadsheet_id": "={{ $('–°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞').item.json.id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "client_id",
              "displayName": "client_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_site",
              "displayName": "client_site",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "employee_email",
              "displayName": "employee_email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_status",
              "displayName": "client_status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "folder_id",
              "displayName": "folder_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "spreadsheet_id",
              "displayName": "spreadsheet_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "ii999999-9999-9999-9999-999999999999",
      "name": "–°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1568,
        -272
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "-1003503638426",
        "text": "=üìÅ <b>–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç</b>\n\nüåê –°–∞–π—Ç: {{ $('–ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?').item.json.client_site }}\n‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ –Ω–∞ Google Drive\nüìä –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞: {{ $('–°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞').item.json.id }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "gg777777-7777-7777-7777-777777777777",
      "name": "Telegram: –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1680,
        -352
      ],
      "credentials": {
        "telegramApi": {
          "id": "mHbM43fsaWN90avF",
          "name": "I.Redin - ws tg log"
        }
      }
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json._spreadsheet_id }}/values/–î–∞–Ω–Ω—ã–µ!A:T",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "options": {}
      },
      "id": "f2c4a852-d64a-404c-bb32-f37ab79add75",
      "name": "–ß–∏—Ç–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è upsert",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1792,
        1320
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Upsert –ª–æ–≥–∏–∫–∞: –Ω–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É –ø–æ period+site –∏ –æ–±–Ω–æ–≤–∏—Ç—å, –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é\nconst inputData = $('–ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?').all();\nconst sheetResponse = $input.first().json;\nconst sheetValues = sheetResponse.values || [];\n\n// –ü–æ–ª—É—á–∞–µ–º spreadsheet_id –∏–∑ –ø–µ—Ä–≤–æ–≥–æ item\nconst spreadsheetId = inputData[0]?.json._spreadsheet_id;\n\n// –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–∏–æ–¥–∞: 2025.2 -> 2025.02\nfunction normPeriod(p) {\n  const s = String(p || '');\n  const parts = s.split('.');\n  if (parts.length === 2) return parts[0] + '.' + parts[1].padStart(2, '0');\n  return s;\n}\n\n// –°–æ–∑–¥–∞—ë–º –∏–Ω–¥–µ–∫—Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–∫: \"period_site\" -> rowIndex\nconst existingRows = new Map();\nfor (let i = 1; i < sheetValues.length; i++) { // Skip header row\n  const row = sheetValues[i];\n  const period = normPeriod(row[1]); // Column B = period\n  const site = row[3] || '';   // Column D = site\n  const key = `${period}_${site}`;\n  existingRows.set(key, {\n    rowIndex: i + 1, // 1-based for Sheets API\n    rowData: row\n  });\n}\n\nconst results = [];\n\nfor (const item of inputData) {\n  const row = item.json;\n  const key = `${normPeriod(row.period)}_${row.site}`;\n  const existing = existingRows.get(key);\n  \n  // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏\n  const newRowData = [\n    row.date || '',\n    row.period || '',\n    row.client_site || '',\n    row.site || '',\n    row.type || '',\n    row['Monthly Visits'] || '',\n    row['Unique Visitors'] || '',\n    row['Visit Duration'] || '',\n    row['Pages/Visit'] || '',\n    row['Bounce Rate'] || '',\n    row.Direct || '',\n    row['Organic Search'] || '',\n    row['Paid Search'] || '',\n    row['Display Ads'] || '',\n    row.Social || '',\n    row.Email || '',\n    row['AI Traffic'] || '',\n    row['Task ID'] || '',\n    row['Queue ID'] || '',\n    row.key || ''\n  ];\n  \n  if (existing) {\n    // Merge: —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≥–¥–µ –Ω–æ–≤—ã–µ –ø—É—Å—Ç—ã–µ\n    const mergedData = newRowData.map((newVal, idx) => {\n      if (newVal === '' && existing.rowData[idx]) {\n        return existing.rowData[idx];\n      }\n      return newVal;\n    });\n    \n    results.push({\n      json: {\n        action: 'update',\n        spreadsheetId,\n        rowIndex: existing.rowIndex,\n        range: `–î–∞–Ω–Ω—ã–µ!A${existing.rowIndex}:T${existing.rowIndex}`,\n        values: [mergedData]\n      }\n    });\n  } else {\n    results.push({\n      json: {\n        action: 'append',\n        spreadsheetId,\n        values: [newRowData]\n      }\n    });\n  }\n}\n\nreturn results;\n"
      },
      "id": "9acd6c9c-77c5-4934-b8e3-626d999a9832",
      "name": "Upsert –ª–æ–≥–∏–∫–∞ Performance",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2016,
        1320
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "is-update",
              "leftValue": "={{ $json.action }}",
              "rightValue": "update",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "e2b2a1d6-3223-433f-ab03-ae8a4ab222cc",
      "name": "Update –∏–ª–∏ Append?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2240,
        1320
      ]
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json.spreadsheetId }}/values/{{ $json.range }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "valueInputOption",
              "value": "USER_ENTERED"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ values: $json.values }) }}",
        "options": {}
      },
      "id": "e505aa2f-81b6-4b88-9b17-0e74dbd62804",
      "name": "Update —Å—Ç—Ä–æ–∫—É",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2464,
        1220
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json.spreadsheetId }}/values/–î–∞–Ω–Ω—ã–µ!A:T:append",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "valueInputOption",
              "value": "USER_ENTERED"
            },
            {
              "name": "insertDataOption",
              "value": "INSERT_ROWS"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ values: $json.values }) }}",
        "options": {}
      },
      "id": "9854fd20-fcf4-4b47-a1f6-02bde5e3a1ab",
      "name": "Append —Å—Ç—Ä–æ–∫—É",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2464,
        1420
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json._spreadsheet_id }}/values/–î–∞–Ω–Ω—ã–µ!A:T",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "options": {}
      },
      "id": "8b1a2504-799d-491e-b909-2c37de3b5870",
      "name": "–ß–∏—Ç–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è AI upsert",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1584,
        1328
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Upsert –ª–æ–≥–∏–∫–∞ AI Traffic: –Ω–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É –ø–æ period+site –∏ –æ–±–Ω–æ–≤–∏—Ç—å AI Traffic\nconst inputData = $('–ï—Å—Ç—å AI –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?').all();\nconst sheetResponse = $input.first().json;\nconst sheetValues = sheetResponse.values || [];\n\nconst spreadsheetId = inputData[0]?.json._spreadsheet_id;\n\n// –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–∏–æ–¥–∞: 2025.2 -> 2025.02\nfunction normPeriod(p) {\n  const s = String(p || '');\n  const parts = s.split('.');\n  if (parts.length === 2) return parts[0] + '.' + parts[1].padStart(2, '0');\n  return s;\n}\n\n// –°–æ–∑–¥–∞—ë–º –∏–Ω–¥–µ–∫—Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–∫\nconst existingRows = new Map();\nfor (let i = 1; i < sheetValues.length; i++) {\n  const row = sheetValues[i];\n  const period = normPeriod(row[1]);\n  const site = row[3] || '';\n  const key = `${period}_${site}`;\n  existingRows.set(key, {\n    rowIndex: i + 1,\n    rowData: row\n  });\n}\n\nconst results = [];\n\nfor (const item of inputData) {\n  const row = item.json;\n  const key = `${normPeriod(row.period)}_${row.site}`;\n  const existing = existingRows.get(key);\n  \n  const newRowData = [\n    row.date || '',\n    row.period || '',\n    row.client_site || '',\n    row.site || '',\n    row.type || '',\n    row['Monthly Visits'] || '',\n    row['Unique Visitors'] || '',\n    row['Visit Duration'] || '',\n    row['Pages/Visit'] || '',\n    row['Bounce Rate'] || '',\n    row.Direct || '',\n    row['Organic Search'] || '',\n    row['Paid Search'] || '',\n    row['Display Ads'] || '',\n    row.Social || '',\n    row.Email || '',\n    row['AI Traffic'] || '',\n    row['Task ID'] || '',\n    row['Queue ID'] || '',\n    row.key || ''\n  ];\n  \n  if (existing) {\n    const mergedData = newRowData.map((newVal, idx) => {\n      if (newVal === '' && existing.rowData[idx]) {\n        return existing.rowData[idx];\n      }\n      return newVal;\n    });\n    \n    results.push({\n      json: {\n        action: 'update',\n        spreadsheetId,\n        rowIndex: existing.rowIndex,\n        range: `–î–∞–Ω–Ω—ã–µ!A${existing.rowIndex}:T${existing.rowIndex}`,\n        values: [mergedData]\n      }\n    });\n  } else {\n    results.push({\n      json: {\n        action: 'append',\n        spreadsheetId,\n        values: [newRowData]\n      }\n    });\n  }\n}\n\nreturn results;\n"
      },
      "id": "4abe4c03-051d-4d39-a4a9-0bc2cda97491",
      "name": "Upsert –ª–æ–≥–∏–∫–∞ AI Traffic",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1808,
        1328
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "is-update-ai",
              "leftValue": "={{ $json.action }}",
              "rightValue": "update",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "d0694be2-d6c5-4b21-8c88-e8a30c08c9f0",
      "name": "AI Update –∏–ª–∏ Append?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2032,
        1328
      ]
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json.spreadsheetId }}/values/{{ $json.range }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "valueInputOption",
              "value": "USER_ENTERED"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ values: $json.values }) }}",
        "options": {}
      },
      "id": "5c2d5b5d-fb95-459e-9d37-52d53983de95",
      "name": "AI Update —Å—Ç—Ä–æ–∫—É",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2256,
        1228
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json.spreadsheetId }}/values/–î–∞–Ω–Ω—ã–µ!A:T:append",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "valueInputOption",
              "value": "USER_ENTERED"
            },
            {
              "name": "insertDataOption",
              "value": "INSERT_ROWS"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ values: $json.values }) }}",
        "options": {}
      },
      "id": "66444218-3c1a-40f3-8531-d633568eb1b6",
      "name": "AI Append —Å—Ç—Ä–æ–∫—É",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2256,
        1428
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Cron: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã (2x –≤ –¥–µ–Ω—å)": {
      "main": [
        [
          {
            "node": "–ß–∏—Ç–∞–µ–º –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ß–∏—Ç–∞–µ–º –æ—á–µ—Ä–µ–¥—å (–ø—Ä–æ–≤–µ—Ä–∫–∞)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤": {
      "main": [
        [
          {
            "node": "–û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ò–∑–≤–ª–µ–∫–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ": {
      "main": [
        [
          {
            "node": "–ê–Ω–∞–ª–∏–∑ –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ê–Ω–∞–ª–∏–∑ –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö": {
      "main": [
        [
          {
            "node": "–ï—Å—Ç—å –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏?": {
      "main": [
        [
          {
            "node": "–î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å": {
      "main": [
        [
          {
            "node": "Telegram: –ó–∞–¥–∞—á–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cron: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏": {
      "main": [
        [
          {
            "node": "–ß–∏—Ç–∞–µ–º –æ—á–µ—Ä–µ–¥—å",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º –æ—á–µ—Ä–µ–¥—å": {
      "main": [
        [
          {
            "node": "Filter: –¢–æ–ª—å–∫–æ pending",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º –æ—á–µ—Ä–µ–¥—å (–ø—Ä–æ–≤–µ—Ä–∫–∞)": {
      "main": [
        [
          {
            "node": "–û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Filter: –¢–æ–ª—å–∫–æ pending": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–¥–∞—á (–º–∞–∫—Å 9)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–¥–∞—á (–º–∞–∫—Å 9)": {
      "main": [
        [
          {
            "node": "–†–∞–Ω–¥–æ–º–Ω–∞—è –ø–∞—É–∑–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–†–∞–Ω–¥–æ–º–Ω–∞—è –ø–∞—É–∑–∞": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ URL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ URL": {
      "main": [
        [
          {
            "node": "–°—Ç–∞—Ç—É—Å: processing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°—Ç–∞—Ç—É—Å: processing": {
      "main": [
        [
          {
            "node": "–ó–∞–ø—É—Å–∫ Performance Robot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–ø—É—Å–∫ Performance Robot": {
      "main": [
        [
          {
            "node": "–ñ–¥—ë–º Performance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ñ–¥—ë–º Performance": {
      "main": [
        [
          {
            "node": "–ó–∞–ø—É—Å–∫ Marketing Channels Robot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–ø—É—Å–∫ Marketing Channels Robot": {
      "main": [
        [
          {
            "node": "–ñ–¥—ë–º Marketing Channels",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ñ–¥—ë–º Marketing Channels": {
      "main": [
        [
          {
            "node": "–ó–∞–ø—É—Å–∫ AI Traffic Robot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook: Performance Results": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏": {
      "main": [
        [
          {
            "node": "–û—à–∏–±–∫–∞ –∏–ª–∏ —É—Å–ø–µ—Ö?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û—à–∏–±–∫–∞ –∏–ª–∏ —É—Å–ø–µ—Ö?": {
      "main": [
        [
          {
            "node": "–õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Parse Performance Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É": {
      "main": [
        [
          {
            "node": "Telegram: –û—à–∏–±–∫–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Performance Data": {
      "main": [
        [
          {
            "node": "Split Out: Performance",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format Performance Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out: Performance": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã": {
      "main": [
        [
          {
            "node": "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º": {
      "main": [
        [
          {
            "node": "–ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?": {
      "main": [
        [
          {
            "node": "–ß–∏—Ç–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è upsert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Performance Report": {
      "main": [
        [
          {
            "node": "Telegram: Performance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook: AI Traffic Results": {
      "main": [
        [
          {
            "node": "Parse AI Traffic Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse AI Traffic Data": {
      "main": [
        [
          {
            "node": "Split Out: AI Traffic",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format AI Traffic Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out: AI Traffic": {
      "main": [
        [
          {
            "node": "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è AI": {
      "main": [
        [
          {
            "node": "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è AI –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è AI –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º": {
      "main": [
        [
          {
            "node": "–ï—Å—Ç—å AI –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å AI –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?": {
      "main": [
        [
          {
            "node": "–ß–∏—Ç–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è AI upsert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format AI Traffic Report": {
      "main": [
        [
          {
            "node": "Telegram: AI Traffic",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏": {
      "main": [
        [
          {
            "node": "–û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏: done",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ò–∑–≤–ª–µ–∫–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ Drive": {
      "main": [
        [
          {
            "node": "–ü–æ–∏—Å–∫ –ø–∞–ø–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–∏—Å–∫ –ø–∞–ø–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞": {
      "main": [
        [
          {
            "node": "–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∏—Å–∫–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∏—Å–∫–∞": {
      "main": [
        [
          {
            "node": "–ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?": {
      "main": [
        [
          {
            "node": "–°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –∫–ª–∏–µ–Ω—Ç–∞",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "–°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –∫–ª–∏–µ–Ω—Ç–∞": {
      "main": [
        [
          {
            "node": "–°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞": {
      "main": [
        [
          {
            "node": "–°–æ–∑–¥–∞—ë–º –ª–∏—Å—Ç –î–∞–Ω–Ω—ã–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–æ–∑–¥–∞—ë–º –ª–∏—Å—Ç –î–∞–Ω–Ω—ã–µ": {
      "main": [
        [
          {
            "node": "–ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏": {
      "main": [
        [
          {
            "node": "–°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞": {
      "main": [
        [
          {
            "node": "Telegram: –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è upsert": {
      "main": [
        [
          {
            "node": "Upsert –ª–æ–≥–∏–∫–∞ Performance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upsert –ª–æ–≥–∏–∫–∞ Performance": {
      "main": [
        [
          {
            "node": "Update –∏–ª–∏ Append?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update –∏–ª–∏ Append?": {
      "main": [
        [
          {
            "node": "Update —Å—Ç—Ä–æ–∫—É",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Append —Å—Ç—Ä–æ–∫—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è AI upsert": {
      "main": [
        [
          {
            "node": "Upsert –ª–æ–≥–∏–∫–∞ AI Traffic",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upsert –ª–æ–≥–∏–∫–∞ AI Traffic": {
      "main": [
        [
          {
            "node": "AI Update –∏–ª–∏ Append?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Update –∏–ª–∏ Append?": {
      "main": [
        [
          {
            "node": "AI Update —Å—Ç—Ä–æ–∫—É",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Append —Å—Ç—Ä–æ–∫—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook: Marketing Channels Results": {
      "main": [
        [
          {
            "node": "Parse Marketing Channels Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Marketing Channels Data": {
      "main": [
        [
          {
            "node": "Split Out: Marketing Channels",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format MC Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out: Marketing Channels": {
      "main": [
        [
          {
            "node": "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è MC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è MC": {
      "main": [
        [
          {
            "node": "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è MC –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è MC –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º": {
      "main": [
        [
          {
            "node": "–ï—Å—Ç—å MC –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å MC –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?": {
      "main": [
        [
          {
            "node": "–ß–∏—Ç–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è MC upsert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è MC upsert": {
      "main": [
        [
          {
            "node": "Upsert –ª–æ–≥–∏–∫–∞ MC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upsert –ª–æ–≥–∏–∫–∞ MC": {
      "main": [
        [
          {
            "node": "MC Update –∏–ª–∏ Append?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MC Update –∏–ª–∏ Append?": {
      "main": [
        [
          {
            "node": "MC Update —Å—Ç—Ä–æ–∫—É",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MC Append —Å—Ç—Ä–æ–∫—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format MC Report": {
      "main": [
        [
          {
            "node": "Telegram: Marketing Channels",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "timeSavedMode": "fixed",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": true,
    "errorWorkflow": "QQu2DVSfdVpU9Rhw",
    "timeSavedPerExecution": 500
  },
  "versionId": "9943cb9d-4cc4-4766-80d2-ca18926f42c3",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9d17d52227a4e309d92bfdb193ff498ba1e95c0c0bc8ff19ed6534df76683725"
  },
  "id": "C5gcCnSahblLUIjZ",
  "tags": []
}