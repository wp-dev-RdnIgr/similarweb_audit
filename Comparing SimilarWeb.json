{
  "name": "Comparing SimilarWeb",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 7
            }
          ]
        }
      },
      "id": "c30f57a7-e012-4567-82b2-9a333d60c4c5",
      "name": "Cron: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        16,
        528
      ],
      "notes": "–ö–∞–∂–¥—ã–π —á–∞—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—á–µ—Ä–µ–¥—å –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥–æ 9 –∑–∞–¥–∞—á"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 20
            }
          ]
        }
      },
      "id": "2ac92421-090d-483c-8036-7e6359add027",
      "name": "Cron: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        16,
        16
      ],
      "notes": "–†–∞–∑ –≤ –¥–µ–Ω—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª–Ω–æ—Ç—É –¥–∞–Ω–Ω—ã—Ö –∑–∞ 10 –º–µ—Å—è—Ü–µ–≤"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 432048814,
          "mode": "list",
          "cachedResultName": "–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=432048814"
        },
        "options": {}
      },
      "id": "6e969da6-83ef-4e81-86f2-c369a41d9a70",
      "name": "–ß–∏—Ç–∞–µ–º –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        240,
        -48
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 251226707,
          "mode": "list",
          "cachedResultName": "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=251226707"
        },
        "options": {}
      },
      "id": "e937837e-9cc0-4e9e-8f64-53fcad36a036",
      "name": "–ß–∏—Ç–∞–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        240,
        176
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {},
      "id": "39f9149b-75ff-419b-b4f2-fafd98b79844",
      "name": "–û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        464,
        96
      ]
    },
    {
      "parameters": {
        "jsCode": "// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–µ—Å—è—Ü–µ–≤\n// –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: –†–∞–∑–±–∏–≤–∞–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –Ω–∞ –≥—Ä—É–ø–ø—ã –ø–æ 5 —Å–∞–π—Ç–æ–≤ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ SimilarWeb)\nconst competitors = $('–ß–∏—Ç–∞–µ–º –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤').all();\nconst results = $('–ß–∏—Ç–∞–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã').all();\n\n// –ú–∞–∫—Å–∏–º—É–º —Å–∞–π—Ç–æ–≤ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ SimilarWeb (–∫–ª–∏–µ–Ω—Ç + 4 –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞)\nconst MAX_SITES_PER_REQUEST = 5;\n\n// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 –º–µ—Å—è—Ü–µ–≤\nfunction getLast10Months() {\n  const months = [];\n  const now = new Date();\n  \n  for (let i = 1; i <= 10; i++) {\n    const d = new Date(now.getFullYear(), now.getMonth() - i, 1);\n    const year = d.getFullYear();\n    const month = String(d.getMonth() + 1).padStart(2, '0');\n    months.push(`${year}.${month}`);\n  }\n  \n  return months;\n}\n\nconst last10Months = getLast10Months();\n\n// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º\nconst clientCompetitors = new Map();\n\ncompetitors.forEach(row => {\n  const client = row.json.client_site;\n  const competitor = row.json.competitors_site;\n  \n  if (client && competitor) {\n    if (!clientCompetitors.has(client)) {\n      clientCompetitors.set(client, []);\n    }\n    if (!clientCompetitors.get(client).includes(competitor)) {\n      clientCompetitors.get(client).push(competitor);\n    }\n  }\n});\n\n// –°–æ–±–∏—Ä–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\nconst existingKeys = new Set();\nresults.forEach(row => {\n  if (row.json.key) {\n    existingKeys.add(row.json.key);\n  }\n});\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ –Ω–∞ —á–∞–Ω–∫–∏\nfunction chunkArray(array, chunkSize) {\n  const chunks = [];\n  for (let i = 0; i < array.length; i += chunkSize) {\n    chunks.push(array.slice(i, i + chunkSize));\n  }\n  return chunks;\n}\n\n// –°–æ–∑–¥–∞—ë–º –∑–∞–¥–∞—á–∏ —Å —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º –Ω–∞ –≥—Ä—É–ø–ø—ã –ø–æ 4\nconst queueTasks = [];\n\nclientCompetitors.forEach((competitorsList, clientSite) => {\n  // –†–∞–∑–±–∏–≤–∞–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –Ω–∞ –≥—Ä—É–ø–ø—ã –ø–æ 4 (–∫–ª–∏–µ–Ω—Ç + 4 –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ = 5 —Å–∞–π—Ç–æ–≤)\n  const competitorChunks = chunkArray(competitorsList, MAX_SITES_PER_REQUEST - 1);\n  \n  competitorChunks.forEach((chunk, chunkIndex) => {\n    last10Months.forEach((period, periodIndex) => {\n      // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Å–∞–π—Ç–æ–≤: –∫–ª–∏–µ–Ω—Ç + –¥–æ 4 –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤\n      const sitesInRequest = [clientSite, ...chunk];\n      \n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã\n      const missingSites = sitesInRequest.filter(site => {\n        const key = `${period}_${site}`;\n        return !existingKeys.has(key);\n      });\n      \n      // –ï—Å–ª–∏ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–∞–π—Ç –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö - —Å–æ–∑–¥–∞—ë–º –∑–∞–¥–∞—á—É\n      if (missingSites.length > 0) {\n        const taskId = `${clientSite}_${period}_chunk${chunkIndex}_${Date.now()}`;\n        \n        queueTasks.push({\n          queue_id: taskId,\n          client_site: clientSite,\n          sites_list: sitesInRequest.join(','),\n          chunk_index: chunkIndex,\n          total_chunks: competitorChunks.length,\n          period: period,\n          status: 'pending',\n          priority: periodIndex, // –°—Ç–∞—Ä—ã–µ –ø–µ—Ä–∏–æ–¥—ã = –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç\n          created_at: new Date().toISOString().replace('T', ' ').substring(0, 19),\n          task_id: '',\n          error_message: ''\n        });\n      }\n    });\n  });\n});\n\n// –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (—Å–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ)\nqueueTasks.sort((a, b) => b.priority - a.priority);\n\nconst summary = {\n  totalClients: clientCompetitors.size,\n  totalTasks: queueTasks.length,\n  periods: last10Months,\n  maxSitesPerRequest: MAX_SITES_PER_REQUEST\n};\n\nconsole.log('Queue tasks summary:', summary);\n\nif (queueTasks.length === 0) {\n  return [{ json: { noNewTasks: true, summary } }];\n}\n\nreturn queueTasks.map(task => ({ json: task }));"
      },
      "id": "19b85d8a-b590-4d84-aaa8-cea697886401",
      "name": "–ê–Ω–∞–ª–∏–∑ –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        96
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "filter-new-tasks",
              "leftValue": "={{ $json.noNewTasks }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "fb407d3a-3b89-4c14-b095-7f30ae715581",
      "name": "–ï—Å—Ç—å –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏?",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        896,
        96
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 807869987,
          "mode": "list",
          "cachedResultName": "–û—á–µ—Ä–µ–¥—å",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=807869987"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "queue_id",
              "displayName": "queue_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_site",
              "displayName": "client_site",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "sites_list",
              "displayName": "sites_list",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "period",
              "displayName": "period",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "priority",
              "displayName": "priority",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "task_id",
              "displayName": "task_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "error_message",
              "displayName": "error_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "f6b856b1-91c9-4b5d-9553-2699d6b34a39",
      "name": "–î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1120,
        96
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "-1003503638426",
        "text": "=üìã <b>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö</b>\n\n–î–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥—å: {{ $json.length || 1 }}\n\n–ü–µ—Ä–∏–æ–¥—ã: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–µ—Å—è—Ü–µ–≤\n\n‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –º–∞–∫—Å. 4 —Å–∞–π—Ç–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "0d051d82-662e-43b9-a4ac-1a403b04e689",
      "name": "Telegram: –ó–∞–¥–∞—á–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1376,
        96
      ],
      "webhookId": "14ccabb4-4ded-4a6c-a9e1-0c3bb571fb6a",
      "credentials": {
        "telegramApi": {
          "id": "mHbM43fsaWN90avF",
          "name": "I.Redin - ws tg log"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 807869987,
          "mode": "list",
          "cachedResultName": "–û—á–µ—Ä–µ–¥—å",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=807869987"
        },
        "options": {}
      },
      "id": "4be8d998-5720-4df5-9318-efa1c9836741",
      "name": "–ß–∏—Ç–∞–µ–º –æ—á–µ—Ä–µ–¥—å",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        240,
        528
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "filter-pending-queue",
              "leftValue": "={{ $json.status }}",
              "rightValue": "pending",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "1969d3e6-b6bd-4220-a213-0c9fea462961",
      "name": "Filter: –¢–æ–ª—å–∫–æ pending",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        464,
        528
      ]
    },
    {
      "parameters": {
        "jsCode": "// –ë–µ—Ä—ë–º –¥–æ 9 –∑–∞–¥–∞—á –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ä–∞–Ω–¥–æ–º–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏\nconst items = $input.all();\n\nif (items.length === 0) {\n  return [];\n}\n\n// –ë–µ—Ä—ë–º –º–∞–∫—Å–∏–º—É–º 9 –∑–∞–¥–∞—á (–ª–∏–º–∏—Ç Browse AI –≤ —á–∞—Å)\nconst tasksToProcess = items.slice(0, 9);\n\n// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Å–µ–≤–¥–æ-—Ä–∞–Ω–¥–æ–º–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ (3-7 –º–∏–Ω—É—Ç –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏)\nconst tasks = tasksToProcess.map((item, index) => {\n  // –ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 3-4 –º–∏–Ω—É—Ç—ã + —Ä–∞–Ω–¥–æ–º 0-3 –º–∏–Ω—É—Ç—ã\n  const baseDelay = 180 + Math.floor(Math.random() * 60); // 180-240 —Å–µ–∫\n  const randomExtra = Math.floor(Math.random() * 180); // 0-180 —Å–µ–∫\n  const delaySeconds = baseDelay + randomExtra; // 180-420 —Å–µ–∫ (3-7 –º–∏–Ω)\n  \n  // –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏\n  const cumulativeDelay = index * delaySeconds;\n  \n  return {\n    json: {\n      ...item.json,\n      taskIndex: index,\n      delaySeconds: cumulativeDelay,\n      delayMinutes: Math.round(cumulativeDelay / 60),\n      scheduledAt: new Date(Date.now() + cumulativeDelay * 1000).toISOString()\n    }\n  };\n});\n\nconsole.log(`Processing ${tasks.length} tasks with random delays`);\n\nreturn tasks;"
      },
      "id": "653d8084-4808-40d6-bac1-c521f7d04c64",
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–¥–∞—á (–º–∞–∫—Å 9)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        528
      ]
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ä–æ–±–æ—Ç–∞\n// –í–ê–ñ–ù–û: sites_list —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞–∫—Å–∏–º—É–º 4 —Å–∞–π—Ç–∞ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ SimilarWeb)\nconst input = $input.first().json;\n\nconst period = `${input.period}-${input.period}`;\nconst sites = input.sites_list.split(',');\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ª–∏–º–∏—Ç 4 —Å–∞–π—Ç–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–∂–µ —Å–æ–±–ª—é–¥–µ–Ω–æ, –Ω–æ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)\nif (sites.length > 4) {\n  console.warn(`WARNING: Too many sites (${sites.length}), truncating to 4`);\n  sites.length = 4;\n}\n\nconst sitesParam = sites.map(s => s.trim()).join('%2C');\n\n// –î–æ–±–∞–≤–ª—è–µ–º queue_id –≤ URL —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –∏–∑–≤–ª–µ—á—å\nconst queueId = encodeURIComponent(input.queue_id);\n\nconst performanceUrl = `https://pro.similarweb.com/#/digitalsuite/websiteanalysis/overview/website-performance/*/804/${period}?webSource=Total&key=${sitesParam}&qid=${queueId}`;\nconst aiTrafficUrl = `https://pro.similarweb.com/#/digitalsuite/ai-traffic/overview/*/804/${period}?webSource=Total&key=${sitesParam}&qid=${queueId}`;\n\nreturn [{\n  json: {\n    ...input,\n    performanceUrl,\n    aiTrafficUrl,\n    sites,\n    sitesCount: sites.length\n  }\n}];"
      },
      "id": "d4b2714a-4e2a-4eae-99f2-b22ff0ae5bcc",
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ URL",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1120,
        528
      ]
    },
    {
      "parameters": {
        "amount": "={{ $json.delaySeconds }}"
      },
      "id": "77b9c208-e53c-4ddd-b1f0-14508158d1f5",
      "name": "–†–∞–Ω–¥–æ–º–Ω–∞—è –ø–∞—É–∑–∞",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        896,
        528
      ],
      "webhookId": "b9f86f03-61de-46cd-a25e-ed2b0eefd1b5"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 807869987,
          "mode": "list",
          "cachedResultName": "–û—á–µ—Ä–µ–¥—å",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=807869987"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "queue_id": "={{ $json.queue_id }}",
            "status": "processing"
          },
          "matchingColumns": [
            "queue_id"
          ],
          "schema": [
            {
              "id": "queue_id",
              "displayName": "queue_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_site",
              "displayName": "client_site",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sites_list",
              "displayName": "sites_list",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "period",
              "displayName": "period",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "priority",
              "displayName": "priority",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "task_id",
              "displayName": "task_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "error_message",
              "displayName": "error_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "736f8480-5c35-4fba-a16f-e165633fa376",
      "name": "–°—Ç–∞—Ç—É—Å: processing",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1344,
        528
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.browse.ai/v2/robots/019b4af4-9cba-7ebe-aa82-1a9f0486f798/tasks",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"inputParameters\": {\n    \"originUrl\": \"{{ $('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ URL').first().json.performanceUrl }}\"\n  }\n}",
        "options": {}
      },
      "id": "4db97b36-3834-411e-b072-fb871d93b1fb",
      "name": "–ó–∞–ø—É—Å–∫ Performance Robot",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1568,
        528
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "4IkSClA1cWUZRGFP",
          "name": "Browse AI 2.1"
        }
      }
    },
    {
      "parameters": {
        "amount": 40
      },
      "id": "d192014c-7c9d-4846-8a11-671ff18d379d",
      "name": "–ñ–¥—ë–º Performance",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1776,
        528
      ],
      "webhookId": "c7dd6269-f291-40a4-a5fb-720e598e2f66"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.browse.ai/v2/robots/019b4bde-9c4f-7c46-b23d-966f14fa5e51/tasks",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"inputParameters\": {\n    \"originUrl\": \"{{ $('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ URL').first().json.aiTrafficUrl }}\"\n  }\n}",
        "options": {}
      },
      "id": "482e9e1c-93f9-4a33-a206-dbc01ece6e49",
      "name": "–ó–∞–ø—É—Å–∫ AI Traffic Robot",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2000,
        480
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "4IkSClA1cWUZRGFP",
          "name": "Browse AI 2.1"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "browse-ai-performance",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "4ace39dc-5c32-4679-841b-fe1a01a80ba1",
      "name": "Webhook: Performance Results",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        16,
        928
      ],
      "webhookId": "browse-ai-performance"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "browse-ai-aitraffic",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "6787af06-960c-4788-aaac-d163c6b6a281",
      "name": "Webhook: AI Traffic Results",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        16,
        1328
      ],
      "webhookId": "browse-ai-aitraffic"
    },
    {
      "parameters": {
        "jsCode": "// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏\nconst input = $input.first().json;\n\nconst taskStatus = input.body?.task?.status || input.status;\nconst taskId = input.body?.task?.id || 'unknown';\nconst finishedAt = input.body?.task?.finishedAt;\nconst robotId = input.body?.robot?.id || 'unknown';\nconst originUrl = input.body?.task?.inputParameters?.originUrl || '';\n\n// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ä–æ–±–æ—Ç–∞\nconst isPerformance = originUrl.includes('website-performance');\nconst robotType = isPerformance ? 'Performance' : 'AI Traffic';\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ URL\nconst keyMatch = originUrl.match(/key=([^&]+)/);\nlet sites = [];\nif (keyMatch) {\n  sites = decodeURIComponent(keyMatch[1]).split(',');\n}\n\nconst periodMatch = originUrl.match(/\\/804\\/(\\d{4}\\.\\d{2})-/);\nconst period = periodMatch ? periodMatch[1] : 'unknown';\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å\nconst isSuccess = (taskStatus === 'successful' || taskStatus === 'completed') && finishedAt;\n\nif (!isSuccess) {\n  // –ó–∞–¥–∞—á–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å - –ª–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É\n  return [{\n    json: {\n      isError: true,\n      taskId,\n      taskStatus,\n      robotType,\n      robotId,\n      period,\n      sites: sites.join(','),\n      originUrl,\n      errorMessage: input.body?.task?.failedReason || 'Unknown error',\n      timestamp: new Date().toISOString().replace('T', ' ').substring(0, 19),\n      rawResponse: JSON.stringify(input.body || input).substring(0, 1000)\n    }\n  }];\n}\n\n// –ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–∞ - –ø–µ—Ä–µ–¥–∞—ë–º –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É\nreturn [{\n  json: {\n    isError: false,\n    taskId,\n    taskStatus,\n    robotType,\n    period,\n    sites,\n    originUrl,\n    body: input.body\n  }\n}];"
      },
      "id": "2b040f47-f893-4c96-bcf8-1ddcc5f90364",
      "name": "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        240,
        928
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "is-error",
              "leftValue": "={{ $json.isError }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "d5a26790-1297-4843-87d8-5c6f3e8e98e5",
      "name": "–û—à–∏–±–∫–∞ –∏–ª–∏ —É—Å–ø–µ—Ö?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        464,
        928
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1263404191,
          "mode": "list",
          "cachedResultName": "–õ–æ–≥–∏ –æ—à–∏–±–æ–∫",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=1263404191"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $json.timestamp }}",
            "task_id": "={{ $json.taskId }}",
            "robot_type": "={{ $json.robotType }}",
            "period": "={{ $json.period }}",
            "sites": "={{ $json.sites }}",
            "status": "={{ $json.taskStatus }}",
            "error_message": "={{ $json.errorMessage }}",
            "url": "={{ $json.originUrl }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "task_id",
              "displayName": "task_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "robot_type",
              "displayName": "robot_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "period",
              "displayName": "period",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "sites",
              "displayName": "sites",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "error_message",
              "displayName": "error_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "b8ad290e-3517-4b06-b176-07d0cab49804",
      "name": "–õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        688,
        800
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "-1003503638426",
        "text": "=‚ùå <b>–û—à–∏–±–∫–∞ —Ä–æ–±–æ—Ç–∞</b>\n\nü§ñ –†–æ–±–æ—Ç: {{ $json.robotType }}\nüìÖ –ü–µ—Ä–∏–æ–¥: {{ $json.period }}\nüåê –°–∞–π—Ç—ã: {{ $json.sites }}\n\n‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: {{ $json.taskStatus }}\nüìù –û—à–∏–±–∫–∞: {{ $json.errorMessage }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "a8dcf2b4-b766-4c7a-8a15-82532cdcb80c",
      "name": "Telegram: –û—à–∏–±–∫–∞",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        896,
        800
      ],
      "webhookId": "b91bfe06-5918-49cb-bcc5-ec2a0c38b614",
      "credentials": {
        "telegramApi": {
          "id": "mHbM43fsaWN90avF",
          "name": "I.Redin - ws tg log"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–∞—Ä—Å–µ—Ä Performance –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–æ–π –¥–ª—è Google Sheets\nconst input = $input.first().json;\n\nconst body = input.body || input;\nconst rawData = body?.task?.capturedTexts || {};\nconst taskId = body?.task?.id || input.taskId || 'unknown';\nconst originUrl = body?.task?.inputParameters?.originUrl || input.originUrl || '';\n\nif (!rawData || Object.keys(rawData).length === 0) {\n  return [];\n}\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–∞–π—Ç—ã –∏–∑ URL\nconst keyMatch = originUrl.match(/key=([^&]+)/);\nlet sitesFromUrl = [];\nif (keyMatch) {\n  sitesFromUrl = decodeURIComponent(keyMatch[1]).split(',');\n}\nconst clientSite = sitesFromUrl[0] || '';\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–µ—Ä–∏–æ–¥ –∏–∑ URL\nconst periodUrlMatch = originUrl.match(/\\/804\\/(\\d{4}\\.\\d{2})-\\d{4}\\.\\d{2}/);\nlet periodFormatted = '';\nif (periodUrlMatch) {\n  periodFormatted = periodUrlMatch[1];\n}\n\nlet data = {};\nif (Array.isArray(rawData)) {\n  rawData.forEach(item => {\n    const key = item.name || item.key;\n    const value = item.newText || item.text || item.value;\n    if (key && value) data[key] = value;\n  });\n} else {\n  data = rawData;\n}\n\nfunction extractLegendData(html) {\n  if (!html) return {};\n  const sites = {};\n  const patterns = [\n    /data-automation-title=\"true\"[^>]*>([^<]+)<\\/label>[\\s\\S]*?data-automation-value=\"true\"[^>]*>([^<]+)<\\/label>/g,\n    /iUaIjL\">([^<]+)<\\/label>[\\s\\S]*?gzsEum\">([^<]+)<\\/label>/g,\n    /lfbxrA\">([^<]+)<\\/label>[\\s\\S]*?gzsEum\">([^<]+)<\\/label>/g,\n    /jNDqYY\">([^<]+)<\\/label>[\\s\\S]*?gzsEum\">([^<]+)<\\/label>/g\n  ];\n  \n  patterns.forEach(pattern => {\n    let match;\n    while ((match = pattern.exec(html)) !== null) {\n      const site = match[1].trim();\n      const value = match[2].trim();\n      if (site && value && site.includes('.')) {\n        sites[site] = value;\n      }\n    }\n  });\n  return sites;\n}\n\nfunction extractTableData(html) {\n  if (!html) return {};\n  const sites = {};\n  \n  const domainPattern = /data-automation=\"domain-name\">([^<]+)<\\/span>/g;\n  const domains = [];\n  let match;\n  while ((match = domainPattern.exec(html)) !== null) {\n    domains.push(match[1].trim());\n  }\n  \n  const valuePattern = /compare-progress-value[^>]*>([^<]+)</g;\n  const values = [];\n  while ((match = valuePattern.exec(html)) !== null) {\n    values.push(match[1].trim());\n  }\n  \n  for (let i = 0; i < domains.length && i < values.length; i++) {\n    sites[domains[i]] = values[i];\n  }\n  \n  return sites;\n}\n\nlet period = 'N/A';\nlet country = 'N/A';\nconst headerHtml = data['Total visits'] || data['Total Visit 2'] || '';\n\nconst periodMatch = headerHtml.match(/(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\\s+\\d{4}/i);\nif (periodMatch) period = periodMatch[0];\n\nif (headerHtml.includes('Ukraine')) country = 'Ukraine';\nelse if (headerHtml.includes('Worldwide')) country = 'Worldwide';\n\nif (!periodFormatted && period !== 'N/A') {\n  const monthMap = {\n    'Jan': '01', 'Feb': '02', 'Mar': '03', 'Apr': '04',\n    'May': '05', 'Jun': '06', 'Jul': '07', 'Aug': '08',\n    'Sep': '09', 'Oct': '10', 'Nov': '11', 'Dec': '12'\n  };\n  const periodParsed = period.match(/(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\\s+(\\d{4})/i);\n  if (periodParsed) {\n    const month = monthMap[periodParsed[1]];\n    const year = periodParsed[2];\n    periodFormatted = `${year}.${month}`;\n  }\n}\n\n// === –õ–û–ì–ò–ö–ê TOTAL VISITS ===\n// 1. –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å –∏–∑ \"Total visits\"\n// 2. –ï—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî –±–µ—Ä—ë–º –∏–∑ \"Total Visit 2\"\n// 3. –ï—Å–ª–∏ –∏ —Ç–∞–º –ø—É—Å—Ç–æ ‚Äî –±—É–¥–µ—Ç \"error\"\nlet totalVisits = {};\n\nif (data['Total visits']) {\n  totalVisits = extractTableData(data['Total visits']);\n}\n\n// Fallback –Ω–∞ Total Visit 2\nif (Object.keys(totalVisits).length === 0 && data['Total Visit 2']) {\n  totalVisits = extractTableData(data['Total Visit 2']);\n}\n\n// –ü–∞—Ä—Å–∏–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã\nconst direct = extractLegendData(data['Direct']);\nconst organicSearch = extractLegendData(data['Organic Search']);\nconst paidSearch = extractLegendData(data['Paid Search']);\nconst displayAds = extractLegendData(data['Display Ads']);\nconst social = extractLegendData(data['Sosial'] || data['Social']);\nconst email = extractLegendData(data['Email']);\n\nconst today = new Date().toISOString().split('T')[0];\n\n// –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–∞–π—Ç—ã\nconst allSites = new Set();\n[totalVisits, direct, organicSearch, paidSearch, displayAds, social, email].forEach(channel => {\n  Object.keys(channel).forEach(site => allSites.add(site));\n});\n\n// –ï—Å–ª–∏ —Å–∞–π—Ç–æ–≤ –Ω–µ—Ç ‚Äî –±–µ—Ä—ë–º –∏–∑ URL\nif (allSites.size === 0 && sitesFromUrl.length > 0) {\n  sitesFromUrl.forEach(site => allSites.add(site));\n}\n\nconst sitesArray = Array.from(allSites);\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ Total Visits\nconst hasTotalVisitsData = Object.keys(totalVisits).length > 0;\n\nconst sheetsRows = sitesArray.map((site) => ({\n  'date': today,\n  'period': periodFormatted,\n  'client_site': clientSite,\n  'competitors_site': site,\n  'type': site === clientSite ? 'client' : 'competitor',\n  'Total Visit': hasTotalVisitsData ? (totalVisits[site] || 'N/A') : 'error',\n  'Direct': direct[site] || '',\n  'Organic Search': organicSearch[site] || '',\n  'Paid Search': paidSearch[site] || '',\n  'Display Ads': displayAds[site] || '',\n  'Social': social[site] || '',\n  'Email': email[site] || '',\n  'AI Traffic': '',\n  'Task ID': taskId,\n  'key': `${periodFormatted}_${site}`\n}));\n\nreturn [{\n  json: {\n    taskId,\n    type: 'performance',\n    period,\n    periodFormatted,\n    country,\n    clientSite,\n    channels: {\n      totalVisits,\n      direct,\n      organicSearch,\n      paidSearch,\n      displayAds,\n      social,\n      email\n    },\n    sheetsRows,\n    raw: data\n  }\n}];"
      },
      "id": "c2ce219d-507c-4ff5-8b2f-c258da680ca1",
      "name": "Parse Performance Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        1040
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "sheetsRows",
        "options": {}
      },
      "id": "0f4f9ca9-e43d-463a-a25d-37e69ec4f3a3",
      "name": "Split Out: Performance",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        896,
        1040
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 251226707,
          "mode": "list",
          "cachedResultName": "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=251226707"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "key"
          ],
          "schema": [
            {
              "id": "date",
              "displayName": "date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "period",
              "displayName": "period",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_site",
              "displayName": "client_site",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "competitors_site",
              "displayName": "competitors_site",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "type",
              "displayName": "type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Total Visit",
              "displayName": "Total Visit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Direct",
              "displayName": "Direct",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Organic Search",
              "displayName": "Organic Search",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Paid Search",
              "displayName": "Paid Search",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Display Ads",
              "displayName": "Display Ads",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Social",
              "displayName": "Social",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "AI Traffic",
              "displayName": "AI Traffic",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Task ID",
              "displayName": "Task ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "key",
              "displayName": "key",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "0b7dea74-10b6-43ee-b102-2cc002c26a92",
      "name": "–°–æ—Ö—Ä–∞–Ω—è–µ–º Performance",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1120,
        1040
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "id",
          "cachedResultName": "–ö–ª–∏–µ–Ω—Ç—ã"
        },
        "options": {}
      },
      "id": "jj000000-0000-0000-0000-000000000001",
      "name": "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1120,
        1320
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞\nconst clients = $('–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã').all();\nconst performanceRows = $('Split Out: Performance').all();\n\n// –°–æ–∑–¥–∞—ë–º –º–∞–ø—É client_site -> spreadsheet_id\nconst clientMap = new Map();\nclients.forEach(c => {\n  if (c.json.client_site && c.json.spreadsheet_id) {\n    clientMap.set(c.json.client_site, c.json.spreadsheet_id);\n  }\n});\n\n// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º\nconst resultsByClient = new Map();\n\nperformanceRows.forEach(row => {\n  const clientSite = row.json.client_site;\n  const spreadsheetId = clientMap.get(clientSite);\n  \n  if (spreadsheetId) {\n    if (!resultsByClient.has(clientSite)) {\n      resultsByClient.set(clientSite, {\n        spreadsheet_id: spreadsheetId,\n        rows: []\n      });\n    }\n    resultsByClient.get(clientSite).rows.push(row.json);\n  }\n});\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—ã –∫–ª–∏–µ–Ω—Ç–æ–≤\nconst output = [];\nresultsByClient.forEach((data, clientSite) => {\n  data.rows.forEach(row => {\n    output.push({\n      json: {\n        ...row,\n        _spreadsheet_id: data.spreadsheet_id\n      }\n    });\n  });\n});\n\nreturn output.length > 0 ? output : [{ json: { noClientData: true } }];"
      },
      "id": "jj000000-0000-0000-0000-000000000002",
      "name": "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1344,
        1320
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "has-client-data",
              "leftValue": "={{ $json.noClientData }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "jj000000-0000-0000-0000-000000000003",
      "name": "–ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        1568,
        1320
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json._spreadsheet_id }}/values/–î–∞–Ω–Ω—ã–µ:append?valueInputOption=USER_ENTERED",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"values\": [[\n    \"{{ $json.date }}\",\n    \"{{ $json.period }}\",\n    \"{{ $json.client_site }}\",\n    \"{{ $json.competitors_site }}\",\n    \"{{ $json.type }}\",\n    \"{{ $json['Total Visit'] }}\",\n    \"{{ $json.Direct }}\",\n    \"{{ $json['Organic Search'] }}\",\n    \"{{ $json['Paid Search'] }}\",\n    \"{{ $json['Display Ads'] }}\",\n    \"{{ $json.Social }}\",\n    \"{{ $json.Email }}\",\n    \"{{ $json['AI Traffic'] }}\",\n    \"{{ $json['Task ID'] }}\",\n    \"{{ $json.key }}\"\n  ]]\n}"
      },
      "id": "jj000000-0000-0000-0000-000000000004",
      "name": "–ü–∏—à–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1792,
        1320
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –æ—á–µ—Ä–µ–¥–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\nconst performanceData = $('Parse Performance Data').first().json;\nconst originUrl = $('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏').first().json.originUrl || '';\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º queue_id –∏–∑ URL\nconst qidMatch = originUrl.match(/qid=([^&]+)/);\nconst queueId = qidMatch ? decodeURIComponent(qidMatch[1]) : '';\n\nconst now = new Date().toISOString().replace('T', ' ').substring(0, 19);\n\nreturn [{\n  json: {\n    queue_id: queueId,\n    status: 'done',\n    task_id: performanceData.taskId\n  }\n}];"
      },
      "id": "c792cf9c-2878-4b26-8ccb-5ebf399da95a",
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1344,
        1040
      ]
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á—ë—Ç –∏–∑ Performance –¥–∞–Ω–Ω—ã—Ö\nconst data = $('Parse Performance Data').first().json;\n\nlet report = 'üìä <b>SimilarWeb Report</b>\\n';\nreport += `üìÖ ${data.periodFormatted} | üá∫üá¶ ${data.country}\\n`;\nreport += `üë§ –ö–ª–∏–µ–Ω—Ç: ${data.clientSite}\\n\\n`;\n\nconst channels = data.channels;\nconst hasChannels = Object.values(channels).some(ch => Object.keys(ch).length > 0);\n\nif (hasChannels) {\n  report += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n';\n  report += 'üö¶ <b>TRAFFIC SOURCES</b>\\n';\n  report += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n\\n';\n  \n  const channelConfig = [\n    { key: 'totalVisits', name: 'Total Visits', emoji: 'üìà' },\n    { key: 'direct', name: 'Direct', emoji: 'üîó' },\n    { key: 'organicSearch', name: 'Organic Search', emoji: 'üîç' },\n    { key: 'paidSearch', name: 'Paid Search', emoji: 'üí∞' },\n    { key: 'displayAds', name: 'Display Ads', emoji: 'üì∫' },\n    { key: 'social', name: 'Social', emoji: 'üì±' },\n    { key: 'email', name: 'Email', emoji: 'üìß' }\n  ];\n  \n  channelConfig.forEach(({ key, name, emoji }) => {\n    const channelData = channels[key];\n    if (channelData && Object.keys(channelData).length > 0) {\n      report += `${emoji} <b>${name}</b>\\n`;\n      Object.entries(channelData).forEach(([site, value], idx) => {\n        const siteEmoji = idx === 0 ? 'üîµ' : idx === 1 ? 'üü†' : idx === 2 ? 'üü¢' : 'üü°';\n        report += `   ${siteEmoji} ${site}: ${value}\\n`;\n      });\n      report += '\\n';\n    }\n  });\n}\n\nreport += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n';\nreport += '‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã';\n\nreturn [{\n  json: {\n    report,\n    ...data\n  }\n}];"
      },
      "id": "4a021a4f-7cab-4c2a-b95c-825217df8e53",
      "name": "Format Performance Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1120,
        1216
      ]
    },
    {
      "parameters": {
        "chatId": "-1003503638426",
        "text": "={{ $json.report }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "b78c405f-2ae4-48a6-be0f-361efa579c3e",
      "name": "Telegram: Performance",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1344,
        1216
      ],
      "webhookId": "d95e8d2d-b66c-4ced-a7fc-c90b43ce5a46",
      "credentials": {
        "telegramApi": {
          "id": "mHbM43fsaWN90avF",
          "name": "I.Redin - ws tg log"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–∞—Ä—Å–µ—Ä AI Traffic –¥–∞–Ω–Ω—ã—Ö\nconst input = $input.first().json;\n\nconst body = input.body || input;\nconst taskStatus = body?.task?.status || input.taskStatus;\n\nif (taskStatus !== 'successful' && taskStatus !== 'completed') {\n  return [];\n}\n\nconst rawData = body?.task?.capturedTexts || {};\nconst taskId = body?.task?.id || input.taskId || 'unknown';\nconst originUrl = body?.task?.inputParameters?.originUrl || input.originUrl || '';\n\nconst keyMatch = originUrl.match(/key=([^&]+)/);\nlet sitesFromUrl = [];\nif (keyMatch) {\n  sitesFromUrl = decodeURIComponent(keyMatch[1]).split(',');\n}\nconst clientSite = sitesFromUrl[0] || '';\n\nlet periodFormatted = '';\nconst periodUrlMatch = originUrl.match(/\\/804\\/(\\d{4}\\.\\d{2})-/);\nif (periodUrlMatch) {\n  periodFormatted = periodUrlMatch[1];\n}\n\nlet data = {};\nif (Array.isArray(rawData)) {\n  rawData.forEach(item => {\n    const key = item.name || item.key;\n    const value = item.newText || item.text || item.value;\n    if (key && value) data[key] = value;\n  });\n} else {\n  data = rawData;\n}\n\nfunction extractLegendData(html) {\n  if (!html) return {};\n  const sites = {};\n  const patterns = [\n    /gcxjWm\">([^<]+)<\\/label><\\/div><label[^>]*gzsEum\">([^<]+)</g,\n    /lfbxrA\">([^<]+)<\\/label>.*?gzsEum\">([^<]+)</g,\n    /data-automation-title=\"true\"[^>]*>([^<]+)<\\/label>.*?data-automation-value=\"true\"[^>]*>([^<]+)<\\/label>/gs\n  ];\n  \n  patterns.forEach(pattern => {\n    let match;\n    while ((match = pattern.exec(html)) !== null) {\n      const site = match[1].trim();\n      const value = match[2].trim();\n      if (site && value && site.includes('.')) {\n        sites[site] = value;\n      }\n    }\n  });\n  return sites;\n}\n\nconst aiTraffic = extractLegendData(data['Avg Traffic']);\nconst today = new Date().toISOString().split('T')[0];\n\n// –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç - –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å–∏ —Å N/A\nconst allSites = Object.keys(aiTraffic);\nif (allSites.length === 0 && sitesFromUrl.length > 0) {\n  sitesFromUrl.forEach(site => allSites.push(site));\n}\n\n// –°–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å–∏: –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö, –µ—Å–ª–∏ –Ω–µ—Ç - N/A\nconst sheetsRows = allSites.map((site) => ({\n  'key': `${periodFormatted}_${site}`,\n  'AI Traffic': aiTraffic[site] || 'N/A'\n}));\n\n// –ï—Å–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ—Ç —Å–∞–π—Ç–æ–≤ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤\nif (sheetsRows.length === 0) {\n  return [];\n}\n\nreturn [{\n  json: {\n    taskId,\n    type: 'aitraffic',\n    clientSite,\n    periodFormatted,\n    aiTraffic,\n    sheetsRows,\n    raw: data\n  }\n}];"
      },
      "id": "56daa802-3f0a-484a-a4f0-1581abab68ca",
      "name": "Parse AI Traffic Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        240,
        1328
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "sheetsRows",
        "options": {}
      },
      "id": "01d364b4-a16f-4757-8952-7f7bc652b036",
      "name": "Split Out: AI Traffic",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        464,
        1328
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 251226707,
          "mode": "list",
          "cachedResultName": "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=251226707"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "key": "={{ $json.key }}",
            "AI Traffic": "={{ $json['AI Traffic'] }}"
          },
          "matchingColumns": [
            "key"
          ],
          "schema": [
            {
              "id": "date",
              "displayName": "date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "period",
              "displayName": "period",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "client_site",
              "displayName": "client_site",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "competitors_site",
              "displayName": "competitors_site",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "type",
              "displayName": "type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Total Visit",
              "displayName": "Total Visit",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Direct",
              "displayName": "Direct",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Organic Search",
              "displayName": "Organic Search",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Paid Search",
              "displayName": "Paid Search",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Display Ads",
              "displayName": "Display Ads",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Social",
              "displayName": "Social",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "AI Traffic",
              "displayName": "AI Traffic",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Task ID",
              "displayName": "Task ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "key",
              "displayName": "key",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "b3131714-bf2c-48ae-b377-7078e1e55e87",
      "name": "–°–æ—Ö—Ä–∞–Ω—è–µ–º AI Traffic",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        688,
        1328
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "id",
          "cachedResultName": "–ö–ª–∏–µ–Ω—Ç—ã"
        },
        "options": {}
      },
      "id": "kk000000-0000-0000-0000-000000000005",
      "name": "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è AI",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        912,
        1328
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è AI Traffic –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞\nconst clients = $('–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è AI').all();\nconst aiRows = $('Split Out: AI Traffic').all();\n\n// –°–æ–∑–¥–∞—ë–º –º–∞–ø—É client_site -> spreadsheet_id\nconst clientMap = new Map();\nclients.forEach(c => {\n  if (c.json.client_site && c.json.spreadsheet_id) {\n    clientMap.set(c.json.client_site, c.json.spreadsheet_id);\n  }\n});\n\n// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º\nconst output = [];\n\naiRows.forEach(row => {\n  const clientSite = row.json.client_site;\n  const spreadsheetId = clientMap.get(clientSite);\n  \n  if (spreadsheetId) {\n    output.push({\n      json: {\n        ...row.json,\n        _spreadsheet_id: spreadsheetId\n      }\n    });\n  }\n});\n\nreturn output.length > 0 ? output : [{ json: { noClientData: true } }];"
      },
      "id": "kk000000-0000-0000-0000-000000000006",
      "name": "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è AI –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1136,
        1328
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "has-ai-client-data",
              "leftValue": "={{ $json.noClientData }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "kk000000-0000-0000-0000-000000000007",
      "name": "–ï—Å—Ç—å AI –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        1360,
        1328
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json._spreadsheet_id }}/values/–î–∞–Ω–Ω—ã–µ:append?valueInputOption=USER_ENTERED",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"values\": [[\n    \"{{ $json.date }}\",\n    \"{{ $json.period }}\",\n    \"{{ $json.client_site }}\",\n    \"{{ $json.competitors_site }}\",\n    \"{{ $json.type }}\",\n    \"{{ $json['Total Visit'] || '' }}\",\n    \"{{ $json.Direct || '' }}\",\n    \"{{ $json['Organic Search'] || '' }}\",\n    \"{{ $json['Paid Search'] || '' }}\",\n    \"{{ $json['Display Ads'] || '' }}\",\n    \"{{ $json.Social || '' }}\",\n    \"{{ $json.Email || '' }}\",\n    \"{{ $json['AI Traffic'] }}\",\n    \"{{ $json['Task ID'] }}\",\n    \"{{ $json.key }}\"\n  ]]\n}"
      },
      "id": "kk000000-0000-0000-0000-000000000008",
      "name": "–ü–∏—à–µ–º AI –≤ —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1584,
        1328
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á—ë—Ç –∏–∑ AI Traffic –¥–∞–Ω–Ω—ã—Ö\nconst data = $('Parse AI Traffic Data').first().json;\n\nlet report = 'ü§ñ <b>AI TRAFFIC</b>\\n';\nreport += `üìÖ ${data.periodFormatted}\\n`;\nreport += '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n\\n';\n\nconst aiTraffic = data.aiTraffic || {};\n\nif (Object.keys(aiTraffic).length > 0) {\n  Object.entries(aiTraffic).forEach(([site, value], idx) => {\n    const emoji = idx === 0 ? 'üîµ' : idx === 1 ? 'üü†' : idx === 2 ? 'üü¢' : 'üü°';\n    report += `${emoji} ${site}: <b>${value}</b>\\n`;\n  });\n} else {\n  report += '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ AI Traffic\\n';\n}\n\nreport += '\\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n';\nreport += '‚úÖ AI Traffic —Å–æ—Ö—Ä–∞–Ω—ë–Ω';\n\nreturn [{\n  json: {\n    report,\n    ...data\n  }\n}];"
      },
      "id": "bf059aa6-9054-4c56-8bc8-b383c8ca02e6",
      "name": "Format AI Traffic Report",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        1504
      ]
    },
    {
      "parameters": {
        "chatId": "-1003503638426",
        "text": "={{ $json.report }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "9f4d1389-7d54-4223-922c-aa320e750272",
      "name": "Telegram: AI Traffic",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        896,
        1504
      ],
      "webhookId": "47978784-7cd7-48fd-a4a1-b564e65c92ca",
      "credentials": {
        "telegramApi": {
          "id": "mHbM43fsaWN90avF",
          "name": "I.Redin - ws tg log"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 807869987,
          "mode": "list",
          "cachedResultName": "–û—á–µ—Ä–µ–¥—å",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU/edit#gid=807869987"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "queue_id": "={{ $json.queue_id }}",
            "status": "done",
            "task_id": "={{ $json.task_id }}"
          },
          "matchingColumns": [
            "queue_id"
          ],
          "schema": [
            {
              "id": "queue_id",
              "displayName": "queue_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "client_site",
              "displayName": "client_site",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sites_list",
              "displayName": "sites_list",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "period",
              "displayName": "period",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "priority",
              "displayName": "priority",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "task_id",
              "displayName": "task_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "error_message",
              "displayName": "error_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "6cf86895-175e-432d-8259-09fff265593e",
      "name": "–û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏: done",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1568,
        1040
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ó–ê–î–ê–ß–ê ‚Ññ1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ Google Drive\n// –ò–∑–≤–ª–µ–∫–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ —Å–ø–∏—Å–∫–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤\nconst competitors = $('–ß–∏—Ç–∞–µ–º –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤').all();\n\n// –°–æ–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤\nconst uniqueClients = new Set();\ncompetitors.forEach(row => {\n  const client = row.json.client_site;\n  if (client) {\n    uniqueClients.add(client);\n  }\n});\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞–ø–æ–∫\nconst clients = Array.from(uniqueClients).map(client => ({\n  json: {\n    client_site: client,\n    folder_name: client // –ò–º—è –ø–∞–ø–∫–∏ = –∏–º—è —Å–∞–π—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞\n  }\n}));\n\nconsole.log(`Found ${clients.length} unique clients`);\nreturn clients;"
      },
      "id": "aa111111-1111-1111-1111-111111111111",
      "name": "–ò–∑–≤–ª–µ–∫–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        240,
        -272
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–ø–∫—É –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ Google Drive API\n// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤\nconst clientSite = $input.item.json.client_site;\nconst parentFolderId = '1Z069NZFgLq1zBS9EM3fKLFfkyq8BO1h9';\n\n// –ü–µ—Ä–µ–¥–∞—ë–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è HTTP Request –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º client_site –≤ output\nreturn {\n  client_site: clientSite,\n  folder_name: clientSite,\n  parent_folder_id: parentFolderId,\n  query: `mimeType='application/vnd.google-apps.folder' and name='${clientSite}' and '${parentFolderId}' in parents and trashed=false`\n};"
      },
      "id": "bb222222-2222-2222-2222-222222222222",
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ Drive",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        464,
        -272
      ]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://www.googleapis.com/drive/v3/files",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDriveOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "={{ $json.query }}"
            },
            {
              "name": "fields",
              "value": "files(id,name)"
            }
          ]
        },
        "options": {}
      },
      "id": "bb222222-2222-2222-2222-222222222223",
      "name": "–ü–æ–∏—Å–∫ –ø–∞–ø–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        688,
        -272
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞ –ø–∞–ø–∫–∏\nconst files = $input.item.json.files || [];\nconst clientSite = $('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ Drive').item.json.client_site;\n\nconst folderExists = files.length > 0;\nconst folderId = folderExists ? files[0].id : null;\n\nreturn {\n  client_site: clientSite,\n  folder_exists: folderExists,\n  folder_id: folderId,\n  folder_name: clientSite\n};"
      },
      "id": "cc333333-3333-3333-3333-333333333333",
      "name": "–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∏—Å–∫–∞",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        -272
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "folder-exists-check",
              "leftValue": "={{ $json.folder_exists }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "dd444444-4444-4444-4444-444444444444",
      "name": "–ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        896,
        -272
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://www.googleapis.com/drive/v3/files",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDriveOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"name\": \"{{ $json.folder_name }}\",\n  \"mimeType\": \"application/vnd.google-apps.folder\",\n  \"parents\": [\"1Z069NZFgLq1zBS9EM3fKLFfkyq8BO1h9\"]\n}",
        "options": {}
      },
      "id": "ee555555-5555-5555-5555-555555555555",
      "name": "–°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –∫–ª–∏–µ–Ω—Ç–∞",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1120,
        -352
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://www.googleapis.com/drive/v3/files",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDriveOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"name\": \"SimilarWeb Data - {{ $('–ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?').item.json.client_site }}\",\n  \"mimeType\": \"application/vnd.google-apps.spreadsheet\",\n  \"parents\": [\"{{ $json.id }}\"]\n}"
      },
      "id": "ff666666-6666-6666-6666-666666666666",
      "name": "–°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1344,
        -352
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "LKAQlCpSzzSEwEwA",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json.id }}:batchUpdate",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"requests\": [\n    {\n      \"addSheet\": {\n        \"properties\": {\n          \"title\": \"–î–∞–Ω–Ω—ã–µ\"\n        }\n      }\n    }\n  ]\n}"
      },
      "id": "hh888888-8888-8888-8888-888888888888",
      "name": "–°–æ–∑–¥–∞—ë–º –ª–∏—Å—Ç –î–∞–Ω–Ω—ã–µ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1456,
        -352
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1ftyhDQ0px7gI1mjbZB-lFY8hyTQeM4Gy1mlHHnXoNPU",
          "mode": "list",
          "cachedResultName": "Comparing SimilarWeb"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "id",
          "cachedResultName": "–ö–ª–∏–µ–Ω—Ç—ã"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "client_site": "={{ $('–ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?').item.json.client_site }}",
            "folder_id": "={{ $('–°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –∫–ª–∏–µ–Ω—Ç–∞').item.json.id }}",
            "spreadsheet_id": "={{ $('–°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞').item.json.id }}"
          },
          "matchingColumns": [],
          "schema": [
            {"id": "client_id", "displayName": "client_id", "required": false, "defaultMatch": false, "display": true, "type": "string", "canBeUsedToMatch": true},
            {"id": "client_site", "displayName": "client_site", "required": false, "defaultMatch": false, "display": true, "type": "string", "canBeUsedToMatch": true},
            {"id": "employee_email", "displayName": "employee_email", "required": false, "defaultMatch": false, "display": true, "type": "string", "canBeUsedToMatch": true},
            {"id": "client_status", "displayName": "client_status", "required": false, "defaultMatch": false, "display": true, "type": "string", "canBeUsedToMatch": true},
            {"id": "folder_id", "displayName": "folder_id", "required": false, "defaultMatch": false, "display": true, "type": "string", "canBeUsedToMatch": true},
            {"id": "spreadsheet_id", "displayName": "spreadsheet_id", "required": false, "defaultMatch": false, "display": true, "type": "string", "canBeUsedToMatch": true}
          ]
        },
        "options": {}
      },
      "id": "ii999999-9999-9999-9999-999999999999",
      "name": "–°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1568,
        -272
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "hMp9ISVYVcdpImYl",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "-1003503638426",
        "text": "=üìÅ <b>–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç</b>\n\nüåê –°–∞–π—Ç: {{ $('–ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?').item.json.client_site }}\n‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ –Ω–∞ Google Drive\nüìä –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞: {{ $('–°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞').item.json.id }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "id": "gg777777-7777-7777-7777-777777777777",
      "name": "Telegram: –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1680,
        -352
      ],
      "credentials": {
        "telegramApi": {
          "id": "mHbM43fsaWN90avF",
          "name": "I.Redin - ws tg log"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Cron: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)": {
      "main": [
        [
          {
            "node": "–ß–∏—Ç–∞–µ–º –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ß–∏—Ç–∞–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤": {
      "main": [
        [
          {
            "node": "–û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ò–∑–≤–ª–µ–∫–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã": {
      "main": [
        [
          {
            "node": "–û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "–û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ": {
      "main": [
        [
          {
            "node": "–ê–Ω–∞–ª–∏–∑ –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ê–Ω–∞–ª–∏–∑ –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö": {
      "main": [
        [
          {
            "node": "–ï—Å—Ç—å –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏?": {
      "main": [
        [
          {
            "node": "–î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å": {
      "main": [
        [
          {
            "node": "Telegram: –ó–∞–¥–∞—á–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cron: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏": {
      "main": [
        [
          {
            "node": "–ß–∏—Ç–∞–µ–º –æ—á–µ—Ä–µ–¥—å",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º –æ—á–µ—Ä–µ–¥—å": {
      "main": [
        [
          {
            "node": "Filter: –¢–æ–ª—å–∫–æ pending",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter: –¢–æ–ª—å–∫–æ pending": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–¥–∞—á (–º–∞–∫—Å 9)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–¥–∞—á (–º–∞–∫—Å 9)": {
      "main": [
        [
          {
            "node": "–†–∞–Ω–¥–æ–º–Ω–∞—è –ø–∞—É–∑–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–†–∞–Ω–¥–æ–º–Ω–∞—è –ø–∞—É–∑–∞": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ URL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ URL": {
      "main": [
        [
          {
            "node": "–°—Ç–∞—Ç—É—Å: processing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°—Ç–∞—Ç—É—Å: processing": {
      "main": [
        [
          {
            "node": "–ó–∞–ø—É—Å–∫ Performance Robot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–ø—É—Å–∫ Performance Robot": {
      "main": [
        [
          {
            "node": "–ñ–¥—ë–º Performance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ñ–¥—ë–º Performance": {
      "main": [
        [
          {
            "node": "–ó–∞–ø—É—Å–∫ AI Traffic Robot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook: Performance Results": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏": {
      "main": [
        [
          {
            "node": "–û—à–∏–±–∫–∞ –∏–ª–∏ —É—Å–ø–µ—Ö?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û—à–∏–±–∫–∞ –∏–ª–∏ —É—Å–ø–µ—Ö?": {
      "main": [
        [
          {
            "node": "–õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Parse Performance Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É": {
      "main": [
        [
          {
            "node": "Telegram: –û—à–∏–±–∫–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Performance Data": {
      "main": [
        [
          {
            "node": "Split Out: Performance",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format Performance Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out: Performance": {
      "main": [
        [
          {
            "node": "–°–æ—Ö—Ä–∞–Ω—è–µ–º Performance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–æ—Ö—Ä–∞–Ω—è–µ–º Performance": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã": {
      "main": [
        [
          {
            "node": "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º": {
      "main": [
        [
          {
            "node": "–ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?": {
      "main": [
        [
          {
            "node": "–ü–∏—à–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Format Performance Report": {
      "main": [
        [
          {
            "node": "Telegram: Performance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook: AI Traffic Results": {
      "main": [
        [
          {
            "node": "Parse AI Traffic Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse AI Traffic Data": {
      "main": [
        [
          {
            "node": "Split Out: AI Traffic",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format AI Traffic Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out: AI Traffic": {
      "main": [
        [
          {
            "node": "–°–æ—Ö—Ä–∞–Ω—è–µ–º AI Traffic",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–æ—Ö—Ä–∞–Ω—è–µ–º AI Traffic": {
      "main": [
        [
          {
            "node": "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞–µ–º –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è AI": {
      "main": [
        [
          {
            "node": "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è AI –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è AI –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º": {
      "main": [
        [
          {
            "node": "–ï—Å—Ç—å AI –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å AI –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞?": {
      "main": [
        [
          {
            "node": "–ü–∏—à–µ–º AI –≤ —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Format AI Traffic Report": {
      "main": [
        [
          {
            "node": "Telegram: AI Traffic",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏": {
      "main": [
        [
          {
            "node": "–û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏: done",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ò–∑–≤–ª–µ–∫–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ Drive": {
      "main": [
        [
          {
            "node": "–ü–æ–∏—Å–∫ –ø–∞–ø–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–∏—Å–∫ –ø–∞–ø–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞": {
      "main": [
        [
          {
            "node": "–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∏—Å–∫–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∏—Å–∫–∞": {
      "main": [
        [
          {
            "node": "–ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?": {
      "main": [
        [
          {
            "node": "–°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –∫–ª–∏–µ–Ω—Ç–∞",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "–°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –∫–ª–∏–µ–Ω—Ç–∞": {
      "main": [
        [
          {
            "node": "–°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –∫–ª–∏–µ–Ω—Ç–∞": {
      "main": [
        [
          {
            "node": "–°–æ–∑–¥–∞—ë–º –ª–∏—Å—Ç –î–∞–Ω–Ω—ã–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–æ–∑–¥–∞—ë–º –ª–∏—Å—Ç –î–∞–Ω–Ω—ã–µ": {
      "main": [
        [
          {
            "node": "–°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞": {
      "main": [
        [
          {
            "node": "Telegram: –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "timeSavedMode": "fixed",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": true,
    "errorWorkflow": "QQu2DVSfdVpU9Rhw",
    "timeSavedPerExecution": 500
  },
  "versionId": "9943cb9d-4cc4-4766-80d2-ca18926f42c3",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9d17d52227a4e309d92bfdb193ff498ba1e95c0c0bc8ff19ed6534df76683725"
  },
  "id": "C5gcCnSahblLUIjZ",
  "tags": []
}
